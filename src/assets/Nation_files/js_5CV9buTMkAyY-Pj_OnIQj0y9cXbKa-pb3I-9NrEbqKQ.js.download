const nearByBranchApi="/api/v1/get-one-nearby-branch";const promotionsApi='/api/v1/web-promotions';const searchKey='fca2cd09af45d7872342a882f035a6e3';const nearbyOutletApi='/api/v1/near_by_outlets';const advertisementApi='/api/v1/get-advertisement';let storeQuery;let branchSelectorBranchId;const branchUrlByStoreCodeUrl='/api/v1/branch-url/';function isDeliveryPage(){return window.location.pathname==='/delivery-home-page'||window.location.pathname==='/delivery';}(function($,Drupal){Drupal.behaviors.promotions={attach:function(context,settings){}};$(()=>{branchSelectorBranchId=localStorage.getItem('branch_id');if(localStorage.getItem('international')==1&&(isHomePage()||isDeliveryPage()))$.get({url:branchUrlByStoreCodeUrl+localStorage.getItem('branch_id'),headers:getHeaders(),success(data){window.location.href=data;}});if(branchSelectorBranchId){if(isHomePage()){selectedBranchId=branchSelectorBranchId;populateNearbyBranches=true;}setContentBasedOnLocation(localStorage.getItem('branch_name'),branchSelectorBranchId,localStorage.getItem('city_name'));if(isHomePage())updateContent();}else setGpsLocation();setBranchPromotions();});function setGpsLocation(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(setNearByBranch,narError,{enableHighAccuracy:false,maximumAge:0,timeout:2000});}function narError(error){if(isHomePage())updateContent();}function updateContent(){getPromotions();getVouchers();getBranches();getAdvertisement();}function setNearByBranch(position){$.ajax({url:nearByBranchApi,type:'POST',headers:getHeaders(),data:JSON.stringify({"lat":position.coords.latitude,"long":position.coords.longitude}),dataType:"json",success:function(data){if(!$.isEmptyObject(data)){setBranchInLocalStorage(data.branch_id,data.branch_name,data.city_name,data.international);setContentBasedOnLocation(data.branch_name,data.branch_id,data.city_name);if(isHomePage())updateContent();}}});}function setContentBasedOnLocation(branch_name,branch_id,city_name){$('header .select-address-outlet #bbq-selected-branch, .header-left #bbq-selected-branch, #block-bbqlocationdropdown-7 #bbq-selected-branch, #block-bbqlocationdropdown-6 #bbq-selected-branch').text(branch_name+', '+city_name);$('header .select-address-outlet #bbq-location-select, .header-left #bbq-location-select, #block-bbqlocationdropdown-7 #bbq-location-select, #block-bbqlocationdropdown-6 #bbq-location-select').val(branch_id).trigger('change');$('header .select-address-outlet #bbq-location-select-delivery, .header-left #bbq-location-select-delivery, #block-bbqlocationdropdown-7 #bbq-location-select-delivery, #block-bbqlocationdropdown-6 #bbq-location-select-delivery').val(branch_id).trigger('change');}function setBranchInLocalStorage(branch_id,branch_name,city_name,international=0){localStorage.setItem('branch_id',branch_id);localStorage.setItem('branch_name',branch_name);localStorage.setItem('city_name',city_name);localStorage.setItem('international',international);}$('#bbq-location-card').click(function(){navigator.permissions.query({name:'geolocation'}).then(function(permissionStatus){if(permissionStatus.state=='granted'){localStorage.removeItem('branch_id');setGpsLocation();setTimeout(()=>{location.reload();},500);}else alert('Please allow access to your location for us to get nearest branch');});});$('.delivery__branch-location #bbq-branch-location').click(function(){$('.delivery__branch-location #bbq-branch-location').toggleClass('show');$('.delivery__branch-location #bbq-location-dropdown').toggleClass('show');});$('.header-left #bbq-branch-location').click(function(){$('.header-left #bbq-branch-location').toggleClass('show');$('.header-left #bbq-location-dropdown').toggleClass('show');});$('header .select-address-outlet #bbq-location-select, .header-left #bbq-location-select, header #block-bbqlocationdropdown-7 #bbq-location-select, #block-bbqlocationdropdown-6 #bbq-location-select').on('select2:select',function(e){var data=e.params.data;setBranchInLocalStorage(data.id,data.text,data.element.parentElement.label,data.element.getAttribute('data-international'));setContentBasedOnLocation(data.text,data.id,data.element.parentElement.label);const url=window.location.pathname;if(url.match('\/(restaurants)\/.[^\s]*')||data.element.getAttribute('data-international')==1){e.preventDefault();$.get({url:branchUrlByStoreCodeUrl+data.id,headers:getHeaders(),success(data){window.location.href=data;}});}else $.ajax({url:'/api/v1/branches/'+data.id,type:'GET',headers:getHeaders(),success:function(data){if(!$.isEmptyObject(data)){localStorage.setItem('branch_latitude',data.latitude);localStorage.setItem('branch_longitude',data.longitude);location.reload();}else location.reload();}});});function matchStart(params,data){if($.trim(params.term)==='')return data;if(typeof data.children==='undefined')return null;var filteredChildren=[];$.each(data.children,function(idx,child){if(child.text.toUpperCase().indexOf(params.term.toUpperCase())==0)filteredChildren.push(child);});if(filteredChildren.length){var modifiedData=$.extend({},data,true);modifiedData.children=filteredChildren;return modifiedData;}return null;}$("#block-bbqlocationdropdown-6 #bbq-location-select-delivery, .header-left #bbq-location-select-delivery ").select2({placeholder:'Select Location',matcher:matchBranch});$("#block-bbqlocationdropdown-6 .location--select, .header-left #bbq-location-select").select2({placeholder:'Select Location',matcher:matchBranch});function matchBranch(params,data){if($.trim(params.term)==='')return data;if(typeof data.children==='undefined')return null;if(data.text.toUpperCase().indexOf(params.term.toUpperCase())>-1)return $.extend({},data,true);const filteredChildren=[];$.each(data.children,function(idx,child){if(child.text.toUpperCase().indexOf(params.term.toUpperCase())>-1)filteredChildren.push(child);});if(filteredChildren.length){const modifiedData=$.extend({},data,true);modifiedData.children=filteredChildren;return modifiedData;}return null;}$(document).mouseup(function(e){var location=$('#bbq-location-block');if(!location.is(e.target)&&location.has(e.target).length===0){$('#bbq-location-dropdown').removeClass('show');$('#bbq-branch-location').removeClass('show');}else $('.select2-search__field').click(function(){$('#bbq-location-dropdown').addClass('show');$('#bbq-branch-location').addClass('show');});});$('.branch__info .addtoany_share').append('<span>Share</span>');function getPromotions(){storeQuery=localStorage.getItem('branch_id')?'?branch_id='+localStorage.getItem('branch_id'):'';$.get({url:promotionsApi+storeQuery,headers:getHeaders(),success:function(data){if(data&&data.featured_web_promotions&&data.featured_web_promotions.length)heroPromotions(data.featured_web_promotions);if(data&&data.web_promotions&&data.web_promotions.length){teaserPromotions(data.web_promotions);teaserPromotionsNew(data.web_promotions);}},error:function(error){console.error("Error fetching promotions:",error);}});}function heroPromotions(data){let promotionHtml='';promotionHtml=`<div class="card-carousel" >`;data.forEach((promotion)=>{if(promotion.variant==='SIDEBAR')promotionHtml+=sidebarVariant(promotion.variant,promotion.sub_variant,promotion.hero_text_one,promotion.hero_text_two,promotion.cta_label,promotion.cta_link,promotion.hero_banner);else promotionHtml+=gradientVariant(promotion.variant,promotion.sub_variant,promotion.hero_text_one,promotion.hero_text_two,promotion.cta_label,promotion.cta_link,promotion.hero_banner);});promotionHtml+=`</div>`;$("#homepage-hero-promotions").html(promotionHtml);$('.card-carousel').not('.slick-initialized').slick({infinite:true,slidesToShow:1,slidesToScroll:1,dots:true,arrows:false,fade:true,speed:1000,autoplay:true});}function teaserPromotions(data){let promotionHtml='';$(window).resize(function(){if($(window).width()<=640){promotionHtml=promotionTeasersHeader();promotionHtml+=`<div class="events-carousel bbq-event-mobile">`;data.forEach((promotion)=>{promotionHtml+=promotionTeasers(promotion.title,promotion.teaser_text_one,promotion.teaser_text_two,promotion.promotion_url,promotion.teaser_banner,promotion.teaser_banner_alt);});promotionHtml+=`</div>`;$("#homepage-promotions").html(promotionHtml);}else{promotionHtml=promotionTeasersHeader();promotionHtml+=`<div class="events-carousel">`;data.forEach((promotion)=>{promotionHtml+=promotionTeasers(promotion.title,promotion.teaser_text_one,promotion.teaser_text_two,promotion.promotion_url,promotion.teaser_banner,promotion.teaser_banner_alt);});promotionHtml+=`</div>`;$("#homepage-promotions").html(promotionHtml);$('.events-carousel').not('.slick-initialized').slick({infinite:true,slidesToShow:4,slidesToScroll:1,dots:true,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:1,mobileFirst:true}},{breakpoint:680,settings:{slidesToShow:2,slidesToScroll:1,mobileFirst:true}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:true}}]});$('.slick-track .slick-slide .events--card').parent('div').addClass('slick-item');}}).resize();}function teaserPromotionsNew(data){let promotionHtml='';promotionHtml+=`<div class="image-carousel">`;data.forEach((promotion)=>{promotionHtml+=promotionTeasersNew(promotion.promotion_url,promotion.teaser_banner,promotion.teaser_banner_alt);});promotionHtml+=`</div>`;$("#homepage-promotions-new").html(promotionHtml);$('.image-carousel').not('.slick-initialized').slick({infinite:true,slidesToShow:4,slidesToScroll:1,dots:false,arrows:true,autoplay:true,speed:1000,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:1,mobileFirst:true}},{breakpoint:680,settings:{slidesToShow:2,slidesToScroll:1,mobileFirst:true}},{breakpoint:480,settings:{slidesToShow:2,slidesToScroll:1,rows:1,arrows:false,variableWidth:true}}]});$('.slick-track .slick-slide .card-item').parent('div').addClass('delivery-slick-item');}function sidebarVariant(variant,subVariant,heroTextOne,heroTextTwo,cta,ctaLink,banner){return `<div>
            <div class="card card--variant-${variant} card--subvar-${subVariant}">
              <div class= "card-details" >
                <div class="card-title">
                  ${heroTextOne}
                </div>
                <div class="card-price">
                    ${heroTextTwo}
                </div>
                <div class="card-cta">
                  <a href="${ctaLink}">
                    ${cta}
                  </a>
                </div>
              </div>
              <div class="card-image">
                <img class="lazyload" data-src="${banner}" alt="${heroTextOne} ${heroTextTwo}">
              </div>
            </div>
          </div>`;}function gradientVariant(variant,subVariant,heroTextOne,heroTextTwo,cta,ctaLink,banner){return `<div>
          <div class="card card--variant-${variant} card--subvar-${subVariant}">
            <div class= "card-details" >
              <div class="card-details--left">
                <div class="card-price">
                  ${heroTextOne}
                </div>
                <div class="card-title">
                  ${heroTextTwo}
                </div>
              </div>
              <div class="card-details--right">
                  <div class="card-cta">
                    <a href="${ctaLink}" id="promotion--banner-booknow">
                      ${cta}
                    </a>
                  </div>
              </div>
            </div >
            <div class="card-image">
              <img class="lazyload" data-src="${banner}" alt="${heroTextOne} ${heroTextTwo}">
            </div>
          </div>
        </div>`;}function promotionTeasers(name,teaserTextOne,teaserTextTwo,url,banner,alt){return `
            <div class="events--card" onclick = "window.location = '${url}'">
            <div class="events--card-details">
              <div class="events--card-details--title">
                ${name}
              </div>
              <div class="events--card-details--bottom">
              ${teaserTextOne}
              </div>
              <div class="events--card-details--description">
                ${teaserTextTwo}
              </div>
              <div class="events--card-details--link">
                <a href="${url}" title="">
                  READ MORE
                  <span class="viewMore"></span>
                </a>
              </div>
            </div>
            <div class="events--card-image">
              <img class="lazyload" data-src="${banner}" alt="${alt}">
            </div>
          </div>`;}function promotionTeasersHeader(){return `<div class="layout--header row space-between align-center">
                <div class="layout--header-title">
                  Whatâ€™s On BBQN
                </div>
                <div class="layout--header-link">
                  <a class="row align-center" href="/promotions" title="">
                    View all
                    <span class="viewMore"></span>
                  </a>
                </div>
              </div>`;}function promotionTeasersNew(url,banner,alt){return `<div class="card-item" onclick = "window.location = '${url}'">
      <img class="lazyload" data-src="${banner}" alt="${alt}">
  </div>
  <div class="card-item" onclick = "window.location = '${url}'">
      <img class="lazyload" data-src="${banner}" alt="${alt}">
  </div>
  <div class="card-item" onclick = "window.location = '${url}'">
      <img class="lazyload" data-src="${banner}" alt="${alt}">
  </div>
  `;}function getVouchers(){storeQuery=localStorage.getItem('branch_id')?'?branchId.equals='+localStorage.getItem('branch_id'):'';$.get({url:voucherListingUrl+storeQuery,headers:getHeaders(),success(data){if(data.content)homepageVouchers(data.content);}});}function homepageVouchers(data){let vouchersHtml='';vouchersHtml=vouchersHeader();vouchersHtml+=`<div class="vouchers-carousel">`;data.forEach((voucher)=>{vouchersHtml+=vouchers(voucher.voucher_id,voucher.voucher_url,voucher.voucher_name,voucher.currency_code,voucher.price,voucher.voucher_banner);});vouchersHtml+=`</div>`;$("#homepage-gift-vouchers").html(vouchersHtml);$(".vouchers-carousel").not('.slick-initialized').slick({slidesToShow:3,slidesToScroll:1,dots:true,loop:false,infinite:false,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:1,mobileFirst:true}},{breakpoint:680,settings:{slidesToShow:2,slidesToScroll:2,rows:1,mobileFirst:true}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,rows:1,variableWidth:true}}]});$('.voucher--details .button--atc').click(function(e){e.preventDefault();$(this).next().show();$(this).hide();});}function vouchers(voucher_id,voucher_url,voucher_name,currency_code,price,voucher_banner){return `<article id="${voucher_id}">
                        <div class="voucher">
                            <div class="voucher--details">
                              <div class="voucher--details-title">
                                <a href="${voucher_url}">
                                  ${voucher_name}
                                </a>
                              </div>
                              <div class="voucher--details-price">${getCurrencyCode(currency_code)}${price.toLocaleString("en")}</div>
                              <div class="voucher--details-cta atc">
                                <a id="add-to-cart-${voucher_id}" class="button button--atc">Buy Now</a>
                                <div class="card__footer__form-wrap">
                                  <div class="form form--atc">
                                    <div class="value-button decrease-item">-</div>
                                      <input type="text" class="voucher-quantity-${voucher_id} number" value="0" readonly/>
                                    <div class="value-button increase-item">+</div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="voucher--image">
                              <img class="lazyload" data-src="${voucher_banner}" alt="Voucher - ${voucher_name}">
                            </div>
                        </div>
                      </article>`;}function vouchersHeader(){return `<div class="layout--header row space-between align-center">
                <div class="layout--header-title">
                  Happiness Card For You
                </div>
                <div class="layout--header-link">
                  <a class="row align-center" href="/vouchers" title="">
                    View all
                    <span class="viewMore"></span>
                  </a>
                </div>
              </div>`;}function getBranches(){storeQuery=localStorage.getItem('branch_id')?'?store_code='+localStorage.getItem('branch_id'):'';$.get({url:nearbyOutletApi+storeQuery+'&web_only=1',headers:getHeaders(),success(data){if(!$.isEmptyObject(data))nearbyOutlets(data);}});}function nearbyOutlets(data){let outletsHtml='';outletsHtml=outletsHeader();outletsHtml+=`<div class="nearbyOutlets--block row align-center space-evenly">
           <div class="nearbyOutlets-carousel">`;data.forEach((outlet)=>{outletsHtml+=outletData(outlet.branch_name,outlet.address,outlet.link,outlet.latitude,outlet.longitude,outlet.image);});outletsHtml+=`</div></div>`;$("#bbq-nearby-outlets").html(outletsHtml);$('.nearbyOutlets-carousel').not('.slick-initialized').slick({infinite:true,slidesToShow:3,slidesToScroll:1,dots:true,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:1,mobileFirst:true}},{breakpoint:680,settings:{slidesToShow:2,slidesToScroll:1,mobileFirst:true}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:true}}]});}function outletData(branchName,address,link,latitude,longitude,image){return `<div><div class="nearbyOutlets--card">
                <div class="nearbyOutlets--card-details">
                  <div class="nearbyOutlets--card-details--location">
                    ${branchName}
                  </div>
                  <div class="nearbyOutlets--card-details--address">
                    ${address}
                  </div>
                  <div class="nearbyOutlets--card-details--options">
                    <ul class="row">
                      <li>
                        <a href="${link}#offers">
                          <img class="lazyload" data-src="/themes/custom/bbq_nation/assets/images/offer.svg" alt="">
                          <span>What's On BBQN</span>
                        </a>
                      </li>
                      <li>
                        <a href="${link}#s-branch-menu-tab">
                          <img class="lazyload" data-src="/themes/custom/bbq_nation/assets/images/menu01.svg" alt="">
                          <span>Menu</span>
                        </a>
                      </li>
                      <li>
                        <a href="https://www.google.com/maps?z=12&t=m&q=loc:${latitude}+${longitude}" target="_blank">
                          <img class="lazyload" data-src="/themes/custom/bbq_nation/assets/images/map.svg" alt="">
                          <span>Map</span>
                        </a>
                      </li>
                    </ul>
                  </div>
                  <div class="nearbyOutlets--card-details--link">
                    <a href="${link}" title="">
                      Explore
                      <span class="viewMore"></span>
                    </a>
                  </div>
                  <div class="nearbyOutlets--card-details--cta">
                    <a href="${link}" title="">
                      Reserve table
                    </a>
                  </div>
                </div>
                <div class="nearbyOutlets--card-image">
                  <img class="lazyload" data-src="${image}" alt="Restaurant in ${branchName}">
                </div>
              </div></div>`;}function outletsHeader(){return `<div class="nearbyOutlets--content">
                  <div class="nearbyOutlets--content-title">
                    Explore Nearby Restaurants
                  </div>
                  <div class="nearbyOutlets--content-description">
                    Explore BBQ Restaurants near your Neighbourhood and enjoy our latest cuisines with our exlusive offers and coupons...
                  </div>
                  <div class="nearbyOutlets--content-link">
                    <a href="/restaurants" id="view--all-restaurants">
                      View all locations
                      <span class="viewMore"></span>
                    </a>
                  </div>
                </div>`;}function getAdvertisement(){storeQuery=localStorage.getItem('branch_id')?'?store_code='+localStorage.getItem('branch_id'):'';$.get({url:advertisementApi+storeQuery,headers:getHeaders(),success(data){if(!$.isEmptyObject(data))getLocationBasedAdvertisement(data);}});}function getLocationBasedAdvertisement(data){let outletsHtml='';outletsHtml=`<div class="custom-advertisment-mobile">
                      <h2>${data.advertisement_title}</h2>
                      <div class="field-advertisement-image image">
                        <img src="${data.advertisement_image}" alt="${data.advertisement_image_alt_text}">
                      </div>
                      <div class="field-link link"><a href="${data.advertisement_link}">${data.advertisement_link}</a></div>
                    </div>`;$("#bbq-advertisement").html(outletsHtml);}function setBranchPromotions(){const branchId=$('#branch-id');if(branchId.length>0){storeQuery='?branch_id='+branchId.val();$.get({url:promotionsApi+storeQuery,headers:getHeaders(),success(data){if(data.web_promotions.length)branchPromotions(data.web_promotions);}});}}function branchPromotions(data){let promotionHtml='';promotionHtml=promotionTeasersHeader();promotionHtml+=`<div class="events-carousel">`;data.forEach((promotion)=>{promotionHtml+=promotionTeasers(promotion.title,promotion.teaser_text_one,promotion.teaser_text_two,promotion.promotion_url,promotion.teaser_banner,promotion.teaser_banner_alt);});promotionHtml+=`</div>`;$("#bbq-branch-promotions").html(promotionHtml);$('.events-carousel').slick({infinite:true,slidesToShow:4,slidesToScroll:1,dots:true,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:1,mobileFirst:true}},{breakpoint:680,settings:{slidesToShow:2,slidesToScroll:1,mobileFirst:true}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1,variableWidth:true}}]});$('.slick-track .slick-slide .events--card').parent('div').addClass('slick-item');}$(document).on('click','#header--todaysmenu',(e)=>{if(branchSelectorBranchId&&branchSelectorBranchId.length>0){e.preventDefault();$.get({url:branchUrlByStoreCodeUrl+branchSelectorBranchId,headers:getHeaders(),success(data){window.location.href=data+'#s-branch-menu-tab';}});}});})(jQuery,Drupal);;(function($,Drupal,drupalSettings,once){Drupal.behaviors.bbqSignin={attach:function(context,settings){$(once("bbqtimerload",'#countdown',context)).each(function(){startTimer();});$(once("bbqtoastrmsg",'.signin',context)).each(function(){toastr_message();});if(Cookies.get('Drupal.visitor.social_token_stored')){once('bbqclicklogin',()=>{document.querySelector('.button--signin').click();});$("#form--item-name").show();$(".sign-in").hide();$(".sign-up").hide();$(".sign__social").hide();}if(Cookies.get('Drupal.visitor.social_login_success')){toastr_message();cookies.remove('Drupal.visitor.social_login_success',{path:'/'});}}};$(()=>{$('.social-auth:first-child').addClass('social-login-fb');$('.social-auth:nth-child(2)').addClass('social-login-google');$('.social-auth:nth-child(3)').addClass('social-login-insta');});$(document).on('click','.verify_submit',function(){if(Cookies.get('Drupal.visitor.social_token_stored')){Cookies.remove("Drupal.visitor.social_token_stored");Cookies.remove('Drupal.visitor.social_token_stored',{path:'/'});}});$(document).on('click','#sign-up',function(){$("#form--item-name").show();$(".sign-in").show();$(".sign-up").hide();validLoginSignUpSubmitButton();});$(document).on('click','#sign-in',function(){$("#form--item-name").hide();$(".sign-in").hide();$(".sign-up").show();validLoginSignUpSubmitButton();});$(document).on('click','#close-popup',function(){setTimeout(function(){Cookies.remove("Drupal.visitor.error_msg");Cookies.remove("Drupal.visitor.success_msg");Cookies.remove("Drupal.visitor.bbq_user_exist");Cookies.remove("Drupal.visitor.social_token_stored");Cookies.remove('Drupal.visitor.error_msg',{path:'/'});Cookies.remove('Drupal.visitor.success_msg',{path:'/'});Cookies.remove('Drupal.visitor.bbq_user_exist',{path:'/'});Cookies.remove('Drupal.visitor.social_token_stored',{path:'/'});},1);$('.ui-button-icon').trigger('click');});$(document).on('click','#social-fb-login',function(){$('.social-login-fb img').trigger('click');Moengage.add_user_attribute("ATTRIBUTE_NAME_1","Facebook Login");});$(document).on('click','#social-insta-login',function(){$('.social-login-insta img').trigger('click');Moengage.add_user_attribute("ATTRIBUTE_NAME_1","Insta Login");});$(document).on('click','#social-google-login',function(){$('.social-login-google img').trigger('click');});$(document).on('click','.resend-user-otp',function(){$(this).addClass('resend-otp-once');$(".resend-form-otp").addClass('resend-otp-once');$('.resend-form-otp').mousedown();});function startTimer(){var presentTime=document.getElementById('countdown').innerHTML;var timeArray=presentTime.split(/[:]+/);var m=timeArray[0];var s=checkSecond((timeArray[1]-1));if(s==59)m=m-1;if(m<0){m=0;s=0;}document.getElementById('countdown').innerHTML=m+':'+s;setTimeout(startTimer,1000);}function checkSecond(sec){if(sec<10&&sec>=0)sec='0'+sec;;if(sec<0)sec='59';;return sec;}function toastr_message(){if(Cookies.get('Drupal.visitor.bbq_user_exist'))$('#close-popup').trigger('click');if(Cookies.get('Drupal.visitor.error_msg')){var error_msg=Cookies.get("Drupal.visitor.error_msg");const mobileNumber=$('.login-customer-mobile-number').val();if(error_msg){toastr.error(error_msg);Cookies.remove('Drupal.visitor.error_msg',{path:'/'});Cookies.remove("Drupal.visitor.error_msg");}}if(Cookies.get('Drupal.visitor.success_msg')){var success_msg=Cookies.get("Drupal.visitor.success_msg");Cookies.remove('Drupal.visitor.success_msg',{path:'/'});switch(success_msg){case 'SignUp Successful':toastr.success(success_msg);$('.signin__form-wrapper').hide();$('.signin__success').show();Cookies.remove("Drupal.visitor.social_token_stored");Cookies.remove('Drupal.visitor.social_token_stored',{path:'/'});$('.ui-button-icon').trigger('click');Moengage.add_mobile(localStorage.getItem('mobile_number'));Moengage.add_email(localStorage.getItem('email'));Moengage.track_event("Login_Home",{"Mobile":localStorage.getItem('mobile_number'),"Login_Type":localStorage.getItem('email'),"Success":localStorage.getItem('mobile_number')});location.reload();Cookies.remove("Drupal.visitor.success_msg");break;case 'Login Successful':toastr.success(success_msg);Cookies.remove("Drupal.visitor.social_token_stored");Cookies.remove('Drupal.visitor.social_token_stored',{path:'/'});Cookies.remove("Drupal.visitor.success_msg");$('.ui-button-icon').trigger('click');Moengage.add_mobile(localStorage.getItem('mobile_number'));Moengage.track_event("Login_Home",{"Mobile":localStorage.getItem('mobile_number'),"Login_Type":localStorage.getItem('email'),"Success":localStorage.getItem('mobile_number')});location.reload();break;case 'Otp Sent':toastr.success(success_msg);Cookies.remove("Drupal.visitor.success_msg");break;default:break;}}}function ResendOtp(obj){$.ajax({url:"/api/v1/generate-otp",data:JSON.stringify(obj),type:'POST',headers:getHeaders(),contentType:"application/json; charset=utf-8",dataType:"json",success:function(result){},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")");toastr.error(err.fieldErrors[0].message);}});}$(document).on('input','.sign-up-customer-name',(e)=>{const regex=new RegExp("^[a-zA-Z ]+$");const input=e.currentTarget.value;if(regex.test(input)){validLoginSignUpSubmitButton();return true;}e.preventDefault();validLoginSignUpSubmitButton();e.currentTarget.value=input.substring(0,input.length-1);return false;});$(document).on('input','.login-customer-mobile-number',()=>{validLoginSignUpSubmitButton();});$(document).on('DOMSubtreeModified','#drupal-modal',()=>{validLoginSignUpSubmitButton();});function validLoginSignUpSubmitButton(){let nameStatus;if($('#form--item-name').is(':visible')){const name=$('.sign-up-customer-name').val();Moengage.add_first_name(name);if(name)nameStatus=true;else nameStatus=false;}else nameStatus=true;let mobileNumberStatus;const mobileNumber=$('.login-customer-mobile-number').val();Moengage.add_mobile(mobileNumber);if(mobileNumber&&mobileNumber.length>6)mobileNumberStatus=true;else mobileNumberStatus=false;if(nameStatus&&mobileNumberStatus)enableLoginSignUpButton();else disableLoginSignUpButton();}$(document).on('input','.login-sign-up-otp-input-field',(e)=>{const otp=e.currentTarget.value;if(otp&&otp.length===6)enableOtpSubmitButton();else disableOtpSubmitButton();});function disableOtpSubmitButton(){$('.login-sign-up-otp-submit-button').addClass('anchor-disabled');}function enableOtpSubmitButton(){$('.login-sign-up-otp-submit-button').removeClass('anchor-disabled');}function disableLoginSignUpButton(){$('.login-sign-up-submit-button').addClass('anchor-disabled');}function enableLoginSignUpButton(){$('.login-sign-up-submit-button').removeClass('anchor-disabled');}})(jQuery,Drupal,drupalSettings,once);;const userApi="/api/v1/user";const cartApi="/api/v1/cart-count";(function($,Drupal){Drupal.behaviors.notifications={attach:function(context,settings){}};$(()=>{if(!isAnonymous())$.get({url:userApi,headers:getHeaders(),success(data){setProfile(data);cartCount(data.cart_count);}});if(isAnonymous())if(localStorage.getItem("orderId")!=null)$.get({url:cartApi+"?order_id="+localStorage.getItem("orderId"),headers:getHeaders(),success(data){cartCount(data);}});});function cartCount(data){$("#cart-count").html(data);}function setProfile(data){$(".bbq-mega-profile-name").html(data.name);$("#bbq-profile-name").html(data.name);$("#bbq-reward-points").html(data.bbq_points);$(".bbq-mega-reward-points").html(data.bbq_points);$("#notifications-count").html(data.notification_count);}})(jQuery,Drupal);;const REQUEST_METHODS={POST:'POST',GET:'GET',PUT:'PUT'};const booking_info={price:0,bbqn_smiles_final:'no',bbqn_smiles_explored:'no',happiness_card:null,happiness_card_explored:'no',coupon:null,coupon_explored:'no',reservationDate:null};const PROPS={CURRENCY_CODE:getCurrencyCode(),COUPON_TYPE:'GIFT_COUPON',VOUCHER_TYPE:'GIFT_VOUCHER',DEFAULT_CURRENCY:'INR',VOUCHER_CODE:'GV',COUPON_CODE:'GC',TOTAL_QUANTITY:0,TOTAL_AMOUNT:0,HIDE_LOYALTY_BLOCK:false,ADVANCE_AMOUNT_PAID:0,ADDITIONAL_DISCOUNTS:0,INITIAL_ADDITIONAL_DISCOUNTS:0,BOOKING_TOTAL:0,NET_PAYABLE:0,SUB_TOTAL:0,INITIAL_SUB_TOTAL:0,REMOVED_PAX_AMOUNT:0,GST_BASE_AMOUNT:0,INITIAL_GST_BASE_AMOUNT:0,INITIAL_VAT_AMOUNT:0,START_VAT_AMOUNT:0,INITIAL_SERVICE_CHARGE:0,CGST_AMOUNT:0,SGST_AMOUNT:0,CGST_PER:0,SGST_PER:0,CESS:0,INITIAL_CESS:0,SERVICE_CHARGE:0,VAT_AMOUNT:0,ADDITIONAL_TAXES:0,TAX_AMOUNT:0};const URL={GET_BILLING_DETAILS:'/api/v1/bookings/bill-details/',GET_NEARBY_BRANCHES:'/api/v1/slots',GET_ALL_BRANCHES:'/api/v1/get-all-nearby-branches',GET_BRANCH_BY_ID:(branchId)=>"/api/v1/branches/"+branchId,BUFFET_LIST:'/api/v1/menu-buffet-price',VERIFY_VOUCHERS_ON_RESERVATION:'/api/v1/verify-reservation-vouchers',VERIFY_CORPORATE:'/api/v1/verify-corporates',VERIFY_EMAIL_OTP:'/api/v1/verifyotp',CREATE_BOOKING:'/api/v1/bookings',CREATE_BOOKING_RAZORPAY_ORDER:'/api/v1/bookings/generate-rp-order',GET_OCCASION_JOINED_BY:'/api/v1/get-occasion-joined-by-master',UPDATE_OCCASION_JOINED_BY_SPECIAL_INSTRUCTIONS:'/api/v1/bookings/special-instructions',GET_CORPORATE_OFFERS:'/api/v1/corporate-vouchers',GET_LOYALTY_EXCHANGE_RATE:'/api/v1/loyalty-points-value',GOOGLE_MAPS:'http://maps.google.com/maps?daddr=',BOOKING_RESCHEDULE:'/api/v1/bookings/reschedule',VOUCHER_COUPONS_BASE:'/api/v1/vouchers?transaction_type=BOOKING&voucher_type=',RESERVATION_RULES:'/api/v1/reservation/reservation-rules',UPDATE_ADV_RES_PAYMENT:'/api/v1/reservation/update-adv-res-payment',USER_VOUCHERS:function(){return this.VOUCHER_COUPONS_BASE+PROPS.VOUCHER_CODE;},USER_COUPONS:function(){return this.VOUCHER_COUPONS_BASE+PROPS.COUPON_CODE;}};const TYPE={GET_BILLING_DETAILS:'GET_BILLING_DETAILS'};let preferredBranch;let branchList=[];const singleBranchConstant='SINGLE_BRANCH';const allBranchesConstant='ALL_BRANCHES';const buffetConstant='BUFFET';const menuConstant='MENU';const branchMenuConstant='BRANCH_MENU';const corporateVerificationConstant='VERIFY_CORPORATE';const corporateEmailOtpVerificationConstant='VALIDATE_CORPORATE_EMAIL_OTP';const showVouchersConstant='SHOW_VOUCHERS_CONSTANT';const showCouponsConstant='SHOW_COUPONS_CONSTANT';const applyCouponsConstant='APPLY_COUPONS_CONSTANT';const createBookingConstant='CREAT_BOOKING';const createBookingWithAdvanceConstant='CREAT_BOOKING_WITH_ADVANCE';const payAdvanceAmountConstant='PAY_ADVANCE';const checkAdvanceAmountBranchConstant='CHECK_ADVANCE_BRANCH';const updateAdvanceResPaymentConstant='UPDATE_ADV_RES_PAYMENT';const updateAdvanceResPaymentOnCompleteConstant='UPDATE_ADV_RES_PAYMENT_ON_COMPLETE';const payAdvanceAmountBranchConstant='PAY_ADVANCE_BRANCH';const updateBookingConstant='UPDATE_BOOKING';const completeBookingConstant='COMPLETE_BOOKING';const completeBookingWithAdvanceConstant='COMPLETE_BOOKING_WITH_ADVANCE';const getOccasionJoinedByConstant='OCCASION_JOINED_BY_CONSTANT';const updateSpecialInstructionsConstant='UPDATE_SPECIAL_INSTRUCTIONS_CONSTANT';const corporateOffersConstant='GET_CORPORATE_OFFERS';const getLoyaltyExchangeRateUrlConstant='GET_LOYALTY_EXCHANGE_RATE';const reservationRulesConstant='RESERVATION_RULES';const razorPayApiKey='rzp_live_woEpCznOt0mINU';let isCorporatePageActive=false;let loyaltyPointsApplied;let loyaltyDiscountApplied;let applyLoyaltyPoints=false;let loyaltyPoints;let loyaltyExchangeRate;let selectedBranchId;let selectedBranchName;let selectedDiningType;let selectedSlotId;let selectedSlotName;const todayDate=moment();const tomorrowDate=moment().add(1,'days');let selectedReservationDate=todayDate.clone();let menuList;let buffetList;let multiKidsPack=false;let menuId;let bookingList=new Map();let orderList=new Map();let buffetCurrency;let corporateEmail;let corporateOtpId;let corporateVerified=false;let corporateCouponList=new Map();let couponList=new Map();let voucherList=new Map();let appliedCorporateCoupon;let appliedCoupon;let couponUsed;let appliedVouchers=[];let populateNearbyBranches;let advancePaymentDetails;let advanceTransactionDetails;let advanceBookingData;let specialInstructionsBuilt=false;let bookingId;let billAmount;let currency;let advanceAmount;let selectedReservationTime;let voucherDiscountApplied;let noOfVoucherDiscountAppliedWithPax;let voucherDiscountAppliedWithPax;let couponDiscountApplied;let rescheduledBookingId;let rescheduledBranchId;let bookingData;let branchDetailSelectedBranchId;let branchDetailSelectedReservationDate=todayDate.clone();let branchDetailSelectedSlotId;let branchDetailSelectedReservationTime;let branchDetailSelectedDiningType;let branchDetailSelectedSlotName;const branchSlotConstant="BRANCH_SLOT_CONSTANT";const branchSlotCapacityConstant="BRANCH_SLOT_CAPACITY_CONSTANT";const branchMenu='BRANCH_MENU';const bookingMenu='BOOKING_MENU';const lunchConstant='LUNCH';const dinnerConstant='DINNER';(function($,Drupal,once){Drupal.behaviors.bbqBooking={attach:function(context,settings){userId=settings.user.uid;}};class CreateBooking{constructor(){this.booking_id=rescheduledBookingId;this.branch_id=selectedBranchId;this.slot_id=selectedSlotId;this.reservation_time=selectedReservationTime;this.reservation_date=getFormattedReservationDate(selectedReservationDate);this.booking_details=Array.from(bookingList.values());this.voucher_details=getVoucherDetails();this.loyalty_points=applyLoyaltyPoints?Math.ceil(loyaltyPointsApplied):undefined;this.reservation_type_id=4;this.voucher_meal_discount=calculateVoucherMealDiscount();}}class BillingDetails{constructor(billingDetails){this.id=billingDetails.id;this.bookingId=billingDetails.booking_id;this.bookingStatus=billingDetails.booking_status;this.advanceAmount=billingDetails.advance_amount;this.currency=billingDetails.currency;this.mobileNumber=billingDetails.mobile_number;this.countryCode=billingDetails.country_code;this.title=billingDetails.title;this.customerName=billingDetails.customer_name;this.branchId=billingDetails.branch_id;this.slotId=billingDetails.slot_id;this.reservationDate=billingDetails.reservation_date;this.createdDate=billingDetails.created_date;this.modifiedDate=billingDetails.modified_date;this.createdBy=billingDetails.created_by;this.modifiedBy=billingDetails.modified_by;this.billWithoutTax=billingDetails.bill_without_tax;this.serviceCharge=billingDetails.service_charge;this.serviceChargeAmount=billingDetails.service_charge_amount;this.reservationTime=billingDetails.reservation_time;this.loyaltyPointsAmount=billingDetails.loyalty_points_amount;this.loyaltyPoints=billingDetails.loyalty_points;this.finalBillAmount=billingDetails.final_bill_amount;this.netPayableAmount=billingDetails.net_payable_amount;this.billLink=billingDetails.bill_link;this.packs=billingDetails.packs;this.reservationTypeId=billingDetails.reservation_type_id;this.loyaltyPointsRefund=billingDetails.loyalty_points_refund;this.billJson=new BillJson(JSON.parse(billingDetails.bill_json));}}class BillJson{constructor(billJson){this.date=billJson.date;this.email=billJson.email;this.phone=billJson.phone;this.cessAmount=billJson.cessamt;this.cessInPlaceOfVat=billJson.cessinplaceofvat;this.vatAmount=billJson.vat_amt;this.vatPercentage=billJson.vat_per;this.cgstAmount=billJson.cgst_amt;this.cgstPercentage=billJson.cgst_per;this.sgstAmount=billJson.sgst_amt;this.sgstPercentage=billJson.sgst_per;this.storeNumber=billJson.store_no;this.tableNumber=billJson.table_no;this.numberOfPax=billJson.no_of_pax;this.subTotal=billJson.sub_total;this.vatBaseAmount=billJson.vatbaeamt;this.billStatus=billJson.billstatus;this.gstBaseAmount=billJson.gstbaseamt;this.guestName=billJson.guest_name;this.receiptNumber=billJson.receipt_no;this.serviceCharge=billJson.servcharge;this.storeName=billJson.store_name;this.netPayable=billJson.net_payable;this.officeAddress=billJson.off_address;this.totalAmount=billJson.totalamount;this.crsBookingId=billJson.crsbookingid;this.restAddress=billJson.rest_address;this.specialBooking=billJson.special_booking;this.orderDetails=billJson.order_details?billJson.order_details.map((orderDetails)=>new OrderDetails(orderDetails)):[];this.paymentDetails=billJson.payment_details?billJson.payment_details.map((paymentDetails)=>new PaymentDetails(paymentDetails)):[];this.discountDetails=billJson.discount_details?billJson.discount_details.map((discountDetails)=>new DiscountDetails(discountDetails)):[];}}class OrderDetails{constructor(orderDetails){this.description=orderDetails.description;this.qty=orderDetails.qty;this.rate=orderDetails.rate;this.net=orderDetails.net;}}class PaymentDetails{constructor(paymentDetails){this.name=paymentDetails.name;this.amount=paymentDetails.amount;this.type=paymentDetails.type;this.voucherNumber=paymentDetails.voucher_number;this.paxApplicable=paymentDetails.pax_applicable?paymentDetails.pax_applicable:0;}}class DiscountDetails{constructor(discountDetails){this.name=discountDetails.name;this.amount=discountDetails.amount;this.type=discountDetails.type;this.couponNumber=discountDetails.coupon_number;}}function getVoucherDetails(){let vouchers=[];if(appliedVouchers&&appliedVouchers.length>0)vouchers=appliedVouchers.map((voucher)=>{return new BookingVoucher(voucher);});if(appliedCoupon)vouchers.push(new BookingVoucher(appliedCoupon));else{if(appliedCorporateCoupon)vouchers.push(new BookingVoucher(appliedCorporateCoupon));}if(vouchers.length>0)return vouchers;return undefined;}class BookingVoucher{constructor(voucher){this.title=voucher.title;this.voucher_code=voucher.barCode;this.voucher_type=voucher.voucherType;this.amount=voucher.denomination;this.pax_applicable=voucher.paxApplicable?voucher.paxApplicable:0;}}class CurrentBooking{constructor(buffetId,quantity,total,unitPrice,paxValue){this.menu_id=menuId;this.buffet_id=buffetId;this.packs=quantity;this.total=total;this.unit_price=unitPrice;this.buffet_name=paxValue;}}class Buffet{constructor(data){this.buffetData=data.buffet_data?data.buffet_data.map((buffetData)=>{return new BuffetData(buffetData);}):[];}}class BuffetData{constructor(buffetData){this.buffetId=buffetData.priceId;this.buffetName=buffetData.displayName;this.buffetCustomerType=buffetData.customerType;this.buffetPrice=buffetData.baseAmount;this.buffetCurrency=buffetData.buffetCurrency??'INR';this.buffetType=buffetData.foodType;this.minQty=buffetData.minQty;this.buffetItems=buffetData.buffet_items?buffetData.buffet_items.map((buffetItem)=>{return new BuffetItem(buffetItem);}):[];}}class BuffetItem{constructor(buffetItem){this.name=buffetItem.name;this.menuItems=buffetItem.menu_items?buffetItem.menu_items.map((item)=>{return new MenuItem(item);}):[];}}class MenuItem{constructor(menuItem){this.id=menuItem.id;this.name=menuItem.name;this.tags=menuItem.tags;this.type=menuItem.type;this.image=menuItem.image;this.category=menuItem.category;this.posCode=menuItem.pos_code;this.description=menuItem.description;this.defaultPrice=menuItem.default_price;this.saleTypeAlaCarte=menuItem.sale_type_ala_carte;}}class SlotPostData{constructor(date){this.reservation_date=date;this.branch_id=selectedBranchId?selectedBranchId:undefined;this.dining_type=selectedDiningType?selectedDiningType:undefined;}}class BranchSlotPostData{constructor(){this.reservation_date=getFormattedReservationDate(branchDetailSelectedReservationDate);this.branch_id=branchDetailSelectedBranchId;this.dining_type=branchDetailSelectedDiningType?branchDetailSelectedDiningType:undefined;}}class MenuPostData{constructor(){this.reservation_date=getFormattedReservationDate(selectedReservationDate);this.branch_id=selectedBranchId;this.slot_id=selectedSlotId;this.reservation_time=selectedReservationTime;}}class PreferredBranch{constructor(data,date){this.branchId=data.branch_id;this.branchName=data.branch_name;this.amenities=data.amenities?data.amenities.map((amenity)=>{return new Amenity(amenity);}):[];this.branchImages=data.branch_images;this.slotsAvailabe=data.slots_available?data.slots_available.map((slot)=>{if(slot&&slot.slot_start_time&&slot.slot_start_time.length>0)if(date.isSame(todayDate,'day')){const formattedReservationDate=getFormattedReservationDate(date)+' ';if(moment(formattedReservationDate+slot.slot_start_time).isAfter(todayDate))return new Slot(slot);}else return new Slot(slot);}):[];this.taxDetails=data.taxes.map((tax)=>{return new TaxDetails(tax);});this.serviceCharge=data.service_charge;this.terms=data.terms;}}class TaxDetails{constructor(tax){this.tax=tax.tax;this.taxPercentage=tax.tax_percentage;}}class Amenity{constructor(amenity){this.name=amenity.name;this.description=amenity.description;this.image=amenity.image;}}class Slot{constructor(slot){this.slotId=slot.slot_id;this.slotDesc=slot.slot_desc;this.diningType=slot.dining_type;this.slotStartTime=getFormattedSlotTime(slot.slot_start_time);this.slotReservationTime=slot.slot_start_time;this.slotStopTime=slot.slot_stop_time;this.totalCapacity=slot.total_capacity;this.availableCapacity=slot.available_capacity;}}class BranchList{constructor(branch){this.branchId=branch.branch_id;this.branchName=branch.branch_name;}}class EmailOtpVerification{constructor(email,otpId,otp){this.email=email;this.otp_id=otpId;this.otp=otp;}}class AppliedCoupon{constructor(code,type,denomination){this.voucher_code=code;this.voucher_type=type.trim();this.amount=denomination;}}class Voucher{constructor(voucher){this.barCode=voucher.bar_code;this.currency=voucher.currency;this.denomination=voucher.denomination;this.source=voucher.source;this.status=voucher.status;this.title=voucher.title;this.voucherType=voucher.voucher_type;this.image=voucher.image;this.applicability=voucher.applicability;this.description=voucher.description;this.paxApplicable=voucher.pax_applicable?voucher.pax_applicable:0;}}$.fakeLoader({spinner:'spinner6',bgColor:'rgba(0, 0, 0, 0.5)'});$('.slot-dropdown').select2();$('.branch-dropdown').select2();function isProfilePage(){return window.location.pathname.indexOf("profile")!==-1;}function isPayBillPage(){return window.location.pathname.match(/\/(pay-bill.+)/);}function setRescheduledData(){selectedBranchId=rescheduledBranchId;getBranchList();$('.booking-datepicker').datepicker('setDate',getDatePickerFormattedDate(selectedReservationDate));updateBookingInformation(getFormattedReservationDate(selectedReservationDate));}$(()=>{if(isPayBillPage())getBookingDetails(window.location.pathname.split("/").pop());else{$('#menu-tab').tabs();if(!isProfilePage()){disableReserveButton();const branchIdInput=$('#branch-id');if(branchIdInput){const branchId=branchIdInput.val();if(branchId&&branchId.length>0)updateMenuInBranchDetailPage(branchId);}if(checkLocalStorageDetails()){const isUserIdDefined=setInterval(()=>{if(userId!=='undefined'){clearInterval(isUserIdDefined);if(userId&&parseInt(userId,10)!==0){populateBranchList(branchList);populateBranches(preferredBranch,true);$('.reservation--curtain').addClass('reservation--visible');setBranchDateAndSlot();setDiningType(selectedDiningType,'.lunch','.dinner');setTodayTomorrowCheckBox();updateMenuListing(selectedBranchId);}else getNearbyByOrBranchList();}},100);}else getNearbyByOrBranchList();}else{const observerConfig={attributes:true};const bookingRescheduleBlock=document.getElementById('rescheduled-booking-id');const observer=new MutationObserver(()=>{setRescheduledData();observer.disconnect();});observer.observe(bookingRescheduleBlock,observerConfig);}}});function updateMenuInBranchDetailPage(branchId){const branchMenuTab=$('#branch-menu-tab');if(branchMenuTab.length>0)branchMenuTab.tabs();$('#branch-details-menu-slot').select2();$('#branch-details-menu-date-picker').datepicker({dateFormat:'dd/mm/yy',minDate:0,maxDate:moment().add(1,'M').toDate(),onSelect:updateReservationDateInBranchDetail}).datepicker('setDate',getDatePickerFormattedDate(branchDetailSelectedReservationDate));selectedBranchId=branchId;branchDetailSelectedBranchId=branchId;populateNearbyBranches=true;updateMenuListing(selectedBranchId);getBranchSlot();}function updateBranchMenu(){bookingHttpRequest(URL.BUFFET_LIST,REQUEST_METHODS.POST,{reservation_date:getFormattedReservationDate(branchDetailSelectedReservationDate),branch_id:branchDetailSelectedBranchId,slot_id:branchDetailSelectedSlotId,reservation_time:branchDetailSelectedReservationTime},branchMenuConstant);}function updateReservationDateInBranchDetail(date){let selectedDate;if(date instanceof moment)selectedDate=date;else selectedDate=moment(date,'DD/MM/YYYY');if(!selectedDate.isSame(branchDetailSelectedReservationDate,'day')){branchDetailSelectedReservationDate=selectedDate;updateBranchTodayTomorrowTabs();getBranchSlot();}}function getBranchSlot(){branchDetailSelectedSlotId=undefined;branchDetailSelectedReservationTime=undefined;branchDetailSelectedSlotName=undefined;bookingHttpRequest(URL.GET_NEARBY_BRANCHES,REQUEST_METHODS.POST,new BranchSlotPostData(),branchSlotConstant);}function updateBranchSlot(data){let branch=new PreferredBranch(data.preferred_branch,branchDetailSelectedReservationDate);buildSlotHtml(branch,'#branch-details-menu-slot',branchMenu);updateBranchMenu();}function updateBranchTodayTomorrowTabs(){updateTodayTomorrowTabs(branchDetailSelectedReservationDate,'#branch-details-menu-today','#branch-details-menu-tomorrow');}function setTodayTomorrowCheckBox(){updateTodayTomorrowTabs(selectedReservationDate,'.booking-today','.booking-tomorrow');}function updateTodayTomorrowTabs(date,todaySelector,tomorrowSelector){if(date.isSame(todayDate,'day')){enableOrDisableCheckBox(todaySelector,true);enableOrDisableCheckBox(tomorrowSelector,false);}else if(date.isSame(tomorrowDate,'day')){enableOrDisableCheckBox(tomorrowSelector,true);enableOrDisableCheckBox(todaySelector,false);}else{enableOrDisableCheckBox(tomorrowSelector,false);enableOrDisableCheckBox(todaySelector,false);}}function enableOrDisableCheckBox(selector,status){$(selector).prop('checked',status);}function getNearbyByOrBranchList(){getBranchList();}function populateMenuList(data,isBranch=false){const buffets=data.buffets.buffet_data;const alaCarte=data.menu_data;const beverages=data.beverage_data;let buffetHtml='';let alaCarteHtml='';let beveragesHtml='';let menuItems;let menuTabOne;let menuTabTwo;let menuTabThree;let buffetMenu;let alaCarteMenu;let beveragesMenu;if(isBranch){menuItems=$('#target_menu');menuTabOne=$('#branch-menu-tab-1-main');menuTabTwo=$('#branch-menu-tab-2-main');menuTabThree=$('#branch-menu-tab-3-main');buffetMenu=$('#branch-buffet-menu');alaCarteMenu=$('#branch-a-la-carte-menu');beveragesMenu=$('#branch-beverages-menu');}else{menuItems=$('#booking-menu-items');menuTabOne=$('#menu-tab-1-main');menuTabTwo=$('#menu-tab-2-main');menuTabThree=$('#menu-tab-3-main');buffetMenu=$('#buffet-menu');alaCarteMenu=$('#a-la-carte-menu');beveragesMenu=$('#beverages-menu');}if(!buffets&&!alaCarte&&!beverages)menuItems.hide();else menuItems.show();if(buffets&&buffets.length>0){menuTabOne.show();buffets.forEach((buffet)=>{buffetHtml+=buildBuffetMenuHtml(buffet);});buffetMenu.html(buffetHtml);}else menuTabOne.hide();if(alaCarte&&alaCarte.length>0){menuTabTwo.show();alaCarte.forEach((item)=>{alaCarteHtml+=buildOtherMenu(item);});alaCarteMenu.html(alaCarteHtml);}else menuTabTwo.hide();if(beverages&&beverages.length>0){menuTabThree.show();beverages.forEach((item)=>{beveragesHtml+=buildOtherMenu(item);});beveragesMenu.html(beveragesHtml);}else menuTabThree.hide();}function clearMenu(){menuId=undefined;buffetList=undefined;$('#booking-food-preferences').hide();$('#booking-menu-items').hide();$('.basic-info__menu-block').hide();}function populateBuffetList(data){menuId=data.menu_id??0;const apiBuffets=data.buffets;buffetList=new Buffet(apiBuffets);let buffetHtml='';let kidsPackCount=0;if(apiBuffets){$('#booking-food-preferences').show();$('#booking-no-food-preferences').hide();buffetList.buffetData.every((buffet)=>{if(buffet.buffetCustomerType=='Child')kidsPackCount++;if(kidsPackCount>1){multiKidsPack=true;return false;}return true;});buffetList.buffetData.forEach((buffet)=>{if(!buffetCurrency){currency=buffet.buffetCurrency;buffetCurrency=getCurrencyCode(currency);}buffetHtml+=generateBuffetItemHtml(buffet);});$('#buffet-items').html(buffetHtml);}else{$('#booking-food-preferences').hide();$('#booking-no-food-preferences').show();}}function getBuffetId(event){return parseInt($(event.target).closest('form').attr('id'),10);}function showTotalVoucherAndCorporate(status=true){if(status){$('.reservation__sub-total').show();$('.reservation__discount').addClass('show');PROPS.HIDE_LOYALTY_BLOCK=false;$('.reservation__apply-vouchers').show();$('.reservation__corporate-offers').show();$('.reservation__total').addClass('show');$('.reservation__tnc').show();$('#booking-reserve-button').css('display','block');$('#booking-applied-vouchers').show();}else{$('.reservation__sub-total').hide();$('.reservation__discount').removeClass('show');PROPS.HIDE_LOYALTY_BLOCK=true;$('.reservation__apply-vouchers').hide();$('.reservation__corporate-offers').hide();$('.reservation__total').removeClass('show');$('.reservation__tnc').hide();$('#booking-reserve-button').hide();$('#booking-applied-vouchers').hide();}}$(document).on('click','.decrease-buffet-quantity',(e)=>{updateBooking(e,false);});$(document).on('click','.increase-buffet-quantity',(e)=>{showTotalVoucherAndCorporate();updateBooking(e);});function updateBooking(e,increase=true){if(appliedCorporateCoupon||appliedCoupon||(appliedVouchers&&appliedVouchers.length>0)){e.stopPropagation();toastr.error('Please remove the applied coupons/vouchers to change the quantity');}else{const buffetId=getBuffetId(e);const buffetTotalElement=$(`#booking-buffet-total-${buffetId}`);const unitPrice=parseFloat($(`#buffet-unit-price-${buffetId}`).val());const quantityElement=$(`.buffet-quantity-${buffetId}`);let currentQuantity=parseInt(quantityElement.val(),10);let currentMinQuantity=parseInt($(`#buffet-min-qty-${buffetId}`).val());if(!currentMinQuantity)currentMinQuantity=1;var paxValue=$(e.target).parent().parent().siblings('.reservation__item__title').find('h5').text();if(increase){if(currentQuantity===0){currentQuantity=currentMinQuantity-1;buffetTotalElement.show();}currentQuantity++;const buffetTotal=unitPrice*currentQuantity;setAmountDetails();updateBookingDetails(quantityElement,currentQuantity,buffetTotalElement,buffetTotal,increase,buffetId,unitPrice,paxValue);}else{if(currentQuantity>0){if(currentQuantity<=currentMinQuantity)currentQuantity=1;currentQuantity--;}const buffetTotal=unitPrice*currentQuantity;if(validateBuffetTotal(buffetId,buffetTotal,currentQuantity)){appliedCoupon=undefined;couponUsed=undefined;appliedVouchers=[];appliedCorporateCoupon=undefined;voucherDiscountApplied=undefined;noOfVoucherDiscountAppliedWithPax=undefined;voucherDiscountAppliedWithPax=undefined;couponDiscountApplied=undefined;$('#booking-applied-vouchers').empty();enableCorporateAndCouponLink();setAmountDetails();updateBookingDetails(quantityElement,currentQuantity,buffetTotalElement,buffetTotal,increase,buffetId,unitPrice,paxValue);}}}}function updateBookingDetails(quantityElement,currentQuantity,buffetTotalElement,buffetTotal,increase,buffetId,unitPrice,paxValue){quantityElement.val(currentQuantity);buffetTotalElement.html(getCurrencyCode(buffetCurrency)+''+buffetTotal);if(currentQuantity>0)bookingList.set(buffetId,new CurrentBooking(buffetId,currentQuantity,buffetTotal,unitPrice,paxValue));else{if(!increase&&currentQuantity===0){buffetTotalElement.hide();if(bookingList.has(buffetId))bookingList.delete(buffetId);if(bookingList.size===0)showTotalVoucherAndCorporate(false);}}setBuffetTotal();}function validateBuffetTotal(buffetId,buffetTotal,currentQuantity){if(applyLoyaltyPoints){toastr.error('Please remove the applied smiles before reducing the quantity');return false;}return true;}function setBuffetTotal(){let totalQuantity=0;PROPS.SUB_TOTAL=0;PROPS.REMOVED_PAX_AMOUNT=0;bookingList.forEach((v,k)=>{PROPS.SUB_TOTAL+=v.total;});if(!isPayBillPage()){if(applyLoyaltyPoints)PROPS.SUB_TOTAL-=loyaltyDiscountApplied;if(couponDiscountApplied)PROPS.SUB_TOTAL-=couponDiscountApplied;if(noOfVoucherDiscountAppliedWithPax){if(isPayBillPage())totalQuantity=PROPS.TOTAL_QUANTITY;else totalQuantity=getQuantity();if(totalQuantity<=noOfVoucherDiscountAppliedWithPax){PROPS.REMOVED_PAX_AMOUNT=PROPS.SUB_TOTAL;PROPS.SUB_TOTAL=0;}else{removePaxOnApplyingVoucher();PROPS.SUB_TOTAL-=PROPS.REMOVED_PAX_AMOUNT;}}}PROPS.SUB_TOTAL=PROPS.SUB_TOTAL<0?0:PROPS.SUB_TOTAL;setAmountDetails();}function calculateLoyaltyPoints(){if(loyaltyPoints&&loyaltyPoints>0&&loyaltyExchangeRate&&!PROPS.HIDE_LOYALTY_BLOCK){let total=getBookingTotal(false,false,false);if(!isPayBillPage())if(applyLoyaltyPoints)total+=loyaltyDiscountApplied;const applicableLoyaltyPoints=total/loyaltyExchangeRate;if(!applicableLoyaltyPoints)applyLoyaltyPoints=false;else if(loyaltyPoints>=applicableLoyaltyPoints)loyaltyPointsApplied=applicableLoyaltyPoints;else loyaltyPointsApplied=loyaltyPoints;loyaltyDiscountApplied=loyaltyPointsApplied*loyaltyExchangeRate;setLoyaltyPointsHtml();}else $('#cart-loyalty-points').empty();}function removePaxOnApplyingVoucher(){let noOfPaxToRemove=noOfVoucherDiscountAppliedWithPax;PROPS.REMOVED_PAX_AMOUNT=0;if(!isPayBillPage()){let sortedBuffetItems=new Map([...bookingList.entries()].sort((a,b)=>b[1].unit_price-a[1].unit_price));sortedBuffetItems.forEach((v,k)=>{if(noOfPaxToRemove>0)if(noOfPaxToRemove<=v.packs){PROPS.REMOVED_PAX_AMOUNT+=v.unit_price*noOfPaxToRemove;noOfPaxToRemove-=noOfPaxToRemove;}else{PROPS.REMOVED_PAX_AMOUNT+=v.total;noOfPaxToRemove-=v.packs;}});}else{let sortedOrderDetails=new Map([...orderList.entries()].sort((a,b)=>b[1].rate-a[1].rate));sortedOrderDetails.forEach((v,k)=>{if(noOfPaxToRemove>0)if(noOfPaxToRemove<=v.qty){PROPS.REMOVED_PAX_AMOUNT+=v.rate*noOfPaxToRemove;noOfPaxToRemove-=noOfPaxToRemove;}else{PROPS.REMOVED_PAX_AMOUNT+=v.net;noOfPaxToRemove-=v.qty;}});}}function setAmountDetails(reCalculateTax=false){if(!isPayBillPage()){setSubTotal();calculateTaxAmount();}if(isPayBillPage()&&reCalculateTax){reCalculateTaxAmount();resetTax();}calculateLoyaltyPoints();setBookingTotal();}function setLoyaltyPointsHtml(){let anchorLink;let loyaltyText;let skipLoyalty=false;if(applyLoyaltyPoints){anchorLink='<a href="#" class="remove-link" id="remove-booking-loyalty-points">Remove</a>';loyaltyText=Math.ceil(loyaltyPointsApplied)+' Smiles applied for this transaction';}else if(getBookingTotal()>0){anchorLink=`<a href="#" class="add-link" id="apply-booking-loyalty-points">Add</a>`;loyaltyText=buffetCurrency+Math.ceil(loyaltyDiscountApplied)+' discount applicable by using '+Math.ceil(loyaltyPointsApplied)+' Smiles';}else skipLoyalty=true;if(!skipLoyalty){let loyaltyHtml=`<div class="left">
                          <div class="heading">
                            <h5>BBQN Smiles</h5>
                            ${anchorLink}
                          </div>
                          <span>${loyaltyText}</span>
                          <a href="#" class="t-and-c-text">*T&Cs applicable</a>
                        </div>`;if(applyLoyaltyPoints)loyaltyHtml+=`<div class="right">- ${buffetCurrency}${Math.ceil(loyaltyDiscountApplied)}</div>`;$('#booking-loyalty-points').html(loyaltyHtml);}else $('#booking-loyalty-points').empty();}$(document).on('click','#apply-booking-loyalty-points',(e)=>{e.preventDefault();applyLoyaltyPoints=true;booking_info.bbqn_smiles_final='yes';booking_info.bbqn_smiles_explored='yes';if(!isPayBillPage())setBuffetTotal();setGstBaseAmount();setAmountDetails(true);});$(document).on('click','#remove-booking-loyalty-points',(e)=>{e.preventDefault();applyLoyaltyPoints=false;booking_info.bbqn_smiles_final='no';booking_info.bbqn_smiles_explored='no';if(!isPayBillPage())setBuffetTotal();setGstBaseAmount(false);setAmountDetails(true);});function setSubTotal(){$('#booking-sub-total').html(`${buffetCurrency}${getSubTotal().toFixed(2)}`);}function getSubTotal(){return PROPS.SUB_TOTAL;}function getGstBaseAmount(){return PROPS.GST_BASE_AMOUNT;}function setGstBaseAmount(loyalty=true,tax=false,voucher=false,coupon=true,voucherWithPax=true){if(isPayBillPage())PROPS.GST_BASE_AMOUNT=getBookingTotal(loyalty,tax,voucher,coupon,voucherWithPax).toFixed(2);}function resetTax(){if(isPayBillPage()){$('#billing-tax-details-cgst').text(PROPS.CGST_AMOUNT);$('#billing-tax-details-sgst').text(PROPS.SGST_AMOUNT);$('#billing-tax-details-service-charge').text(PROPS.SERVICE_CHARGE);$('#billing-tax-details-vat').text(PROPS.VAT_AMOUNT);$('#billing-total-amount').text(getBookingTotal(true,true,false,true,true).toFixed(2));}}function setBookingTotal(){let element;if(isPayBillPage())element=$('.billing-final-payable-amount');else element=$('#booking-total');element.html(`${buffetCurrency}${getBookingTotal().toFixed(2)}`);}function getBookingTotal(withLoyalty=true,withTax=true,withVoucher=true,withCoupon=true,withPaxApplicableVoucher=true){let total;total=getSubTotal();if(withTax)total=total+PROPS.TAX_AMOUNT;if(isPayBillPage()&&applyLoyaltyPoints&&withLoyalty)total-=loyaltyDiscountApplied;if(isPayBillPage()&&couponDiscountApplied&&withCoupon)total-=couponDiscountApplied;if(voucherDiscountApplied&&withVoucher)total-=voucherDiscountApplied;if(isPayBillPage()&&PROPS.ADVANCE_AMOUNT_PAID&&withVoucher)total-=PROPS.ADVANCE_AMOUNT_PAID;if(isPayBillPage()&&PROPS.ADDITIONAL_DISCOUNTS)total-=PROPS.ADDITIONAL_DISCOUNTS;if(isPayBillPage()&&noOfVoucherDiscountAppliedWithPax&&withPaxApplicableVoucher){removePaxOnApplyingVoucher();total-=PROPS.REMOVED_PAX_AMOUNT;}booking_info.price=total;booking_info.reservationDate=selectedReservationDate;return total<0?0:total;}function populateBranches(data,formatted=false){disableOrEnableReserveButton();selectedSlotId=undefined;selectedReservationTime=undefined;selectedSlotName=undefined;if(!$.isEmptyObject(data)){if(!formatted)preferredBranch=new PreferredBranch(data.preferred_branch,selectedReservationDate);const branchDropdown=$('.branch-dropdown');if(branchDropdown.find(':selected').val()!==preferredBranch.branchId){selectedBranchId=preferredBranch.branchId;branchDropdown.val(selectedBranchId).trigger('change');}buildSlotHtml(preferredBranch,'.slot-dropdown',bookingMenu);$('#selected-reservation-date').text(getFormattedDate(selectedReservationDate));booking_info.reservationDate=selectedReservationDate;$('#booking-slot-value').text(selectedSlotName);$('#selected-branch-name').text(preferredBranch.branchName);refreshData();setBranchImageAndAmenities();disableOrEnableReserveButton();if($('#s-branch-menu-tab').length)$('#target_menu').parent('li').show();else $('#target_menu').parent('li').hide();}}function buildSlotHtml(branch,selector,type){const slotDropdown=$(selector);slotDropdown.empty();let slotHtml='';branch.slotsAvailabe.forEach((slot)=>{if(slot){if(type===branchMenu){if(!branchDetailSelectedSlotName)branchDetailSelectedSlotName=slot.slotStartTime;if(!branchDetailSelectedSlotId){branchDetailSelectedSlotId=slot.slotId;branchDetailSelectedReservationTime=slot.slotReservationTime;}}else{if(type===bookingMenu){if(!selectedSlotName)selectedSlotName=slot.slotStartTime;if(!selectedSlotId){selectedSlotId=slot.slotId;selectedReservationTime=slot.slotReservationTime;}}}slotHtml+=`<option label="${slot.slotReservationTime}" value="${slot.slotId}">${slot.slotStartTime}</option>`;}});slotDropdown.html(slotHtml);}function setBranchDateAndSlot(){$('.branch-dropdown').val(selectedBranchId).trigger('change');$('.slot-dropdown').val(selectedSlotId).trigger('change');$('.booking-datepicker').datepicker('setDate',getDatePickerFormattedDate(selectedReservationDate));}$('.booking-datepicker').datepicker({dateFormat:'dd/mm/yy',minDate:0,maxDate:moment().add(1,'M').toDate(),onSelect:updateReservationDate}).datepicker('setDate',getDatePickerFormattedDate(selectedReservationDate));$('#booking-corporate-email-submit').click((e)=>{sendCorporateOtp();});$('#booking-resend-corporate-otp').click(()=>{sendCorporateOtp();});function sendCorporateOtp(){corporateEmail=$('#booking-corporate-email').val();bookingHttpRequest(URL.VERIFY_CORPORATE,REQUEST_METHODS.POST,{'corporate_email':corporateEmail},corporateVerificationConstant);}function showCorporateOtpScreen(data,error=false){const emailLabel=$('#booking-corporate-email-label');if(error){emailLabel.text('Please enter a valid corporate email id');emailLabel.addClass('error-message');}else{corporateOtpId=data.otp_id;emailLabel.hide();$('#enter-email').hide();$('#verify-otp').show();}}$('#verify-otp-cta').click(()=>{const otp=$('#booking-corporate-otp').val();bookingHttpRequest(URL.VERIFY_EMAIL_OTP,REQUEST_METHODS.POST,new EmailOtpVerification(corporateEmail,corporateOtpId,otp),corporateEmailOtpVerificationConstant);});function invalidCorporateEmailOtp(){const otpLabel=$('#corporate-otp-label');otpLabel.text('Please enter a valid otp');otpLabel.addClass('error-message');}function verifyCorporateEmailOtp(data){$('#verify-otp').hide();$('#verify-status').show();$('#corporate-offer').hide();$('.reservation--curtain').removeClass('open-corporate-form');corporateOtpId=undefined;isCorporatePageActive=true;const emailLabel=$('#booking-corporate-email-label');emailLabel.removeClass('error-message');const otpLabelElement=$('#corporate-otp-label');otpLabelElement.text('Enter the verification code that sent to your email');otpLabelElement.removeClass('error-message');$('#booking-corporate-otp').val('');corporateVerified=true;showOrHideCorporateButtons();$('#reservation-info').show();}$('#remove-corporate-offer-button').click((e)=>{removeCorporateOffer();e.stopPropagation();});function removeCorporateOffer(){corporateVerified=false;corporateEmail=undefined;corporateOtpId=undefined;showOrHideCorporateButtons(false);$('#enter-email').show().children().show();$('#verify-status').hide();}function loginLink(){$('.button--signin').trigger('click');}$('#booking-show-vouchers').click((e)=>{booking_info.happiness_card_explored='yes';if(!isAnonymous()){e.preventDefault();showBillingPageCurtain();$('#reservation-info').hide();$('#coupons-vouchers').show();$('#coupons-listing').empty();bookingHttpRequest(URL.USER_VOUCHERS(),REQUEST_METHODS.GET,getCouponAndVoucherQueryParam(),showVouchersConstant);}else loginLink();});function showBillingPageCurtain(){if(isPayBillPage())$('.reservation--curtain').addClass('reservation--visible');}function hideBillingPageCurtain(){if(isPayBillPage())$('.reservation--curtain').removeClass('reservation--visible');}function getCouponAndVoucherQueryParam(){let totalQuantity=0;let total=0;if(isPayBillPage()){totalQuantity=PROPS.TOTAL_QUANTITY;total=PROPS.TOTAL_AMOUNT;}else bookingList.forEach((v,k)=>{totalQuantity+=v.packs;total+=v.total;});if(noOfVoucherDiscountAppliedWithPax)totalQuantity-=noOfVoucherDiscountAppliedWithPax;if(selectedReservationTime==undefined||selectedReservationTime.length<=0){let d=new Date();selectedReservationTime=d.getHours()+":"+d.getMinutes()+":00";}return{packs:totalQuantity,reservation_date:getFormattedReservationDate(selectedReservationDate)+" "+selectedReservationTime.slice(0,-3),branch_id:selectedBranchId,slot_id:selectedSlotId,amount:total,currency};}$('#booking-show-coupons').click((e)=>{booking_info.coupon_explored='yes';if(!isAnonymous()){e.preventDefault();showBillingPageCurtain();if(appliedCorporateCoupon)toastr.error('You cannot apply coupon with corporate offer applied');else{$('#reservation-info').hide();$('#coupons-vouchers').show();$('#coupons-listing').empty();bookingHttpRequest(URL.USER_COUPONS(),REQUEST_METHODS.GET,getCouponAndVoucherQueryParam(),showCouponsConstant);}}else loginLink();});function populateCouponsAndVouchers(data,type){if(isCorporatePageActive&&type===corporateOffersConstant){$('#coupons-listing').empty();corporateCouponList=new Map();if(data.vouchers&&data.vouchers.length>0){data.vouchers.forEach((coupon)=>{corporateCouponList.set(coupon.bar_code,new Voucher(coupon));});buildVoucherAndCouponHtml(type);}else $('#coupons-listing').html('<div>No coupons available.</div>');}else if(data&&data.vouchers&&data.vouchers.length>0)if(type===PROPS.COUPON_CODE){couponList=new Map();data.vouchers.forEach((coupon)=>{couponList.set(coupon.bar_code,new Voucher(coupon));});buildVoucherAndCouponHtml(type);}else{if(type===PROPS.VOUCHER_CODE){voucherList=new Map();data.vouchers.forEach((voucher)=>{voucherList.set(voucher.bar_code,new Voucher(voucher));});buildVoucherAndCouponHtml(type);}}else{let couponOrVoucherText;if(type===PROPS.COUPON_CODE){booking_info.coupon=PROPS.COUPON_CODE;couponOrVoucherText='coupons';}else{if(type===PROPS.VOUCHER_CODE){booking_info.happiness_card=PROPS.VOUCHER_CODE;couponOrVoucherText='vouchers';}}$('#coupons-listing').html(`<div>No ${couponOrVoucherText} ${' '} available.</div>`);}}function showOrHideCorporateButtons(status=true){if(status){$('#corporate-offer-applied-badge').show();$('#remove-corporate-offer-button').show();}else{$('#corporate-offer-applied-badge').hide();$('#remove-corporate-offer-button').hide();}}function buildVoucherAndCouponHtml(type){let couponHtml='';let voucherAndCoupons;let tempSubTotal=getBookingTotal();if(isCorporatePageActive&&type===corporateOffersConstant)voucherAndCoupons=corporateCouponList;else if(type===PROPS.VOUCHER_CODE)voucherAndCoupons=voucherList;else{if(type===PROPS.COUPON_CODE)voucherAndCoupons=couponList;}voucherAndCoupons.forEach((v,k)=>{const couponItem=voucherAndCouponItemHtml(v.title,v.voucherType,v.barCode,v.currency,v.denomination,tempSubTotal,type,v.applicability,v.description);if(couponItem)couponHtml+=couponItem;});$('#coupons-listing').html(couponHtml);}function disableCorporateAndCouponLink(){$('.reservation__corporate-link').addClass('anchor-disabled');$('#booking-show-coupons').addClass('anchor-disabled');}function enableCorporateAndCouponLink(){$('.reservation__corporate-link').removeClass('anchor-disabled');$('#booking-show-coupons').removeClass('anchor-disabled');}$('#apply-coupon').click(function(){applyReserveCoupon();});function applyReserveCoupon(){let totalQuantity=0;let total=0;if(isPayBillPage()){totalQuantity=PROPS.TOTAL_QUANTITY;total=PROPS.TOTAL_AMOUNT;}else bookingList.forEach((v,k)=>{totalQuantity+=v.packs;total+=v.total;});if(noOfVoucherDiscountAppliedWithPax)totalQuantity-=noOfVoucherDiscountAppliedWithPax;var setManualCoupon=document.getElementById("apply-coupon-value").value.trim();if(selectedReservationTime==undefined||selectedReservationTime.length<=0){let d=new Date();selectedReservationTime=d.getHours()+":"+d.getMinutes()+":00";}if(setManualCoupon!=0)$.ajax({url:'/api/v1/verify-manual-bar-code',type:'POST',headers:getHeaders(),dataType:"json",data:JSON.stringify({bar_code:setManualCoupon,reservation_date:getFormattedReservationDate(selectedReservationDate)+" "+selectedReservationTime.slice(0,-3),currency,country_code:+91,packs:totalQuantity,amount:total,branch_id:selectedBranchId,slot_id:selectedSlotId,mobile_number:localStorage.getItem('mobile_number')}),success:function(data){if(data.message_type=="success"){const barCode=data.bar_code;let voucherType=data.voucher_type;let voucher;let validCoupon=false;if(voucherType===PROPS.VOUCHER_CODE){if(!voucherList.has(data.bar_code))voucherList.set(data.bar_code,new Voucher(data));voucher=voucherList.get(barCode);appliedVouchers.push(voucher);}else if(voucherType===PROPS.COUPON_CODE){if(!couponList.has(data.bar_code))couponList.set(data.bar_code,new Voucher(data));voucher=couponList.get(barCode);couponUsed=voucher;verifyCouponOnApplying(setManualCoupon);}else{if(voucherType===corporateOffersConstant){if(!corporateCouponList.has(data.bar_code))corporateCouponList.set(data.bar_code,new Voucher(data));voucher=corporateCouponList.get(barCode);disableCorporateAndCouponLink();appliedCorporateCoupon=voucher;}}if(validCoupon||voucherType===PROPS.VOUCHER_CODE)if(voucherType!==PROPS.COUPON_CODE){if(voucher.paxApplicable>0)if(applyLoyaltyPoints||couponDiscountApplied){toastr.error('Previously applied coupon/corporate offers and loyalty points will be removed. Please apply again if needed.');if(applyLoyaltyPoints)$('#remove-booking-loyalty-points').trigger('click');if(appliedCoupon)$('.booking-remove-coupon').trigger('click');if(appliedCorporateCoupon)$('.booking-remove-corporate-coupon').trigger('click');}$('#booking-applied-vouchers').append(appliedVoucherHtml(voucher,voucherType));buildVoucherAndCouponHtml(voucherType);}}else{if(data.data.fieldErrors)toastr.error(data.fieldErrors.field);}},error(data){toastr.error(data.responseJSON.fieldErrors[0].message);}});};$(document).on('click','.booking-apply-coupon',(e)=>{e.preventDefault();const target=e.target;const targetElement=$(target);const barCode=target.id;let voucherType=targetElement.closest('div').attr('class');let voucher;let validCoupon=false;if(voucherType===PROPS.VOUCHER_CODE){voucher=voucherList.get(barCode);appliedVouchers.push(voucher);}else if(voucherType===PROPS.COUPON_CODE){voucher=couponList.get(barCode);couponUsed=voucher;verifyCouponOnApplying(barCode);$('#coupons-vouchers-close').trigger('click');}else{if(voucherType===corporateOffersConstant){voucher=corporateCouponList.get(barCode);disableCorporateAndCouponLink();appliedCorporateCoupon=voucher;}}if(validCoupon||voucherType===PROPS.VOUCHER_CODE)if(voucherType!==PROPS.COUPON_CODE){if(voucher.paxApplicable>0)if(applyLoyaltyPoints||couponDiscountApplied){toastr.error('Previously applied coupon/corporate offers and loyalty points will be removed. Please apply again if needed.');if(applyLoyaltyPoints)$('#remove-booking-loyalty-points').trigger('click');if(appliedCoupon)$('.booking-remove-coupon').trigger('click');if(appliedCorporateCoupon)$('.booking-remove-corporate-coupon').trigger('click');}$('#booking-applied-vouchers').append(appliedVoucherHtml(voucher,voucherType));buildVoucherAndCouponHtml(voucherType);}});function verifyCouponOnApplying(barCode){let totalQuantity=0;let total=0;if(isPayBillPage()){totalQuantity=PROPS.TOTAL_QUANTITY;total=PROPS.TOTAL_AMOUNT;}else bookingList.forEach((v,k)=>{totalQuantity+=v.packs;total+=v.total;});if(noOfVoucherDiscountAppliedWithPax)totalQuantity-=noOfVoucherDiscountAppliedWithPax;if(selectedReservationTime==undefined||selectedReservationTime.length<=0){let d=new Date();selectedReservationTime=d.getHours()+":"+d.getMinutes()+":00";}let couponParameters={'packs':totalQuantity,'reservation_date':getFormattedReservationDate(selectedReservationDate)+" "+selectedReservationTime.slice(0,-3),'branch_id':selectedBranchId,'slot':selectedSlotId,'amount':total,'currency':currency,'bar_code':barCode};bookingHttpRequest(URL.VERIFY_VOUCHERS_ON_RESERVATION,REQUEST_METHODS.POST,couponParameters,applyCouponsConstant);}function validateBookingTotal(amount,total){if(amount>total){toastr.error('Please add more items to apply this voucher/coupon');return false;}return true;}$(document).on('click','.booking-remove-voucher',(e)=>{e.preventDefault();const code=e.target.id;appliedVouchers=appliedVouchers.filter((voucher)=>voucher.barCode!==code);if(voucherList.get(code).paxApplicable==0){voucherDiscountApplied-=voucherList.get(code).denomination;if(voucherDiscountApplied<0)voucherDiscountApplied=0;}else{if(voucherList.get(code).paxApplicable>0){voucherDiscountAppliedWithPax-=voucherList.get(code).denomination;noOfVoucherDiscountAppliedWithPax-=voucherList.get(code).paxApplicable;if(voucherDiscountAppliedWithPax<0)voucherDiscountAppliedWithPax=0;if(noOfVoucherDiscountAppliedWithPax<0)noOfVoucherDiscountAppliedWithPax=0;}}if(!isPayBillPage())setBuffetTotal();setGstBaseAmount();setAmountDetails(true);$(`#applied-voucher-${code}`).remove();});$(document).on('click','.booking-remove-coupon',(e)=>{const code=e.target.id;appliedCoupon=undefined;couponDiscountApplied-=couponList.get(code).denomination;if(couponDiscountApplied<0)couponDiscountApplied=0;if(!isPayBillPage())setBuffetTotal();setGstBaseAmount(true,false,false,false);setAmountDetails(true);$(`#applied-coupon-${code}`).remove();enableCorporateAndCouponLink();});$(document).on('click','.booking-remove-corporate-coupon',(e)=>{const code=e.target.id;appliedCorporateCoupon=undefined;couponDiscountApplied-=corporateCouponList.get(code).denomination;if(couponDiscountApplied<0)couponDiscountApplied=0;if(!isPayBillPage())setBuffetTotal();setGstBaseAmount(true,false,false,false);setAmountDetails(true);$(`#applied-coupon-${code}`).remove();enableCorporateAndCouponLink();});$('#booking-reserve-button').click(()=>{Moengage.track_event("Reservation_Checkout",{"Login_Type":localStorage.getItem('email'),"Mobile":localStorage.getItem('mobile_number'),"Location":$("#selected-branch-name").text()});bookingHttpRequest(URL.GET_BRANCH_BY_ID(selectedBranchId),REQUEST_METHODS.GET,undefined,checkAdvanceAmountBranchConstant);});function checkAdvancePaymentRequired(data){selectedBranchName=data.branch_name;if(data.advance_payment=='1')getBranchSlotCapacity();else createBookingOnly();}function showAdvancePayBranchScreen(){element=$('#advance-pay-branch-amount');element.html(`${buffetCurrency}${advancePaymentDetails.data.advance_amount}`);$('#reservation-info').hide();$('#confirm-advance-pay-branch').hide();$('#retry-advance-pay-branch').hide();$('#refund-advance-pay-branch').hide();$('#advance-pay-branch').show();}function showRetryAdvancePayBranchScreen(){element=$('#retry-advance-pay-branch-amount');element.html(`${buffetCurrency}${advancePaymentDetails.data.advance_amount}`);$('#reservation-info').hide();$('#advance-pay-branch').hide();$('#confirm-advance-pay-branch').hide();$('#refund-advance-pay-branch').hide();$('#retry-advance-pay-branch').show();}function showRefundInitiatedScreen(data){$('#refund-advance-pay-branch-name').html(`${selectedBranchName}`);$('#refund-advance-pay-branch-time').html(`${moment(selectedReservationTime,'hh:mm A').format('hh:mm A')}`);$('#refund-advance-pay-branch-refund-amount').html(`${buffetCurrency}${data.data.payment_refund_amount}`);$('#refund-advance-pay-branch-refund-id').html(`${data.data.payment_refund_id}`);$('#reservation-info').hide();$('#advance-pay-branch').hide();$('#confirm-advance-pay-branch').hide();$('#retry-advance-pay-branch').hide();$('#refund-advance-pay-branch').show();}$('#advance-pay-branch-confirm, #retry-advance-pay-branch-confirm, #advance-pay-branch-confirm-reservation').click((e)=>{e.preventDefault();proceedToBranchAdvancePaymentCheckout(advancePaymentDetails);});$('#refund-advance-pay-branch-confirm, #advance-pay-branch-cancel-reservation').click((e)=>{e.preventDefault();redirectToHomePage();});$('#back-to-reserve-page, #retry-back-to-reserve-page').click((e)=>{e.preventDefault();$('#confirm-advance-pay-branch').show();});function getBranchSlotCapacity(){branchDetailSelectedSlotId=undefined;branchDetailSelectedReservationTime=undefined;branchDetailSelectedSlotName=undefined;bookingHttpRequest(URL.GET_NEARBY_BRANCHES,REQUEST_METHODS.POST,new SlotPostData(getFormattedReservationDate(selectedReservationDate)),branchSlotCapacityConstant);}function checkBranchSlotCapacity(data){let totalQuantity=getQuantity();let selectedSlot=data.preferred_branch.slots_available?data.preferred_branch.slots_available.find(function(slots){return selectedSlotId==slots.slot_id&&selectedReservationTime==slots.slot_start_time;}):[];if(selectedSlot&&selectedSlot.available_capacity>=totalQuantity)checkReservationRules();else toastr.error('Maximum available capacity is '+selectedSlot.available_capacity);}function checkReservationRules(){let reservationRuleDetails=new CreateBooking();reservationRuleDetails={...reservationRuleDetails,...{no_of_pax:parseInt(getQuantity()),payable_amt:parseFloat(getBookingTotal().toFixed(2))}};if(reservationRuleDetails.hasOwnProperty('slot_id')&&typeof reservationRuleDetails.slot_id!=="undefined")reservationRuleDetails.slot_id=reservationRuleDetails.slot_id.toString();if(reservationRuleDetails.hasOwnProperty('loyalty_points')&&typeof reservationRuleDetails.loyalty_points!=="undefined")reservationRuleDetails.loyalty_points_amount=parseFloat(reservationRuleDetails.loyalty_points).toFixed(2).toString();bookingHttpRequest(URL.RESERVATION_RULES,REQUEST_METHODS.POST,reservationRuleDetails,reservationRulesConstant);}function proceedWithBooking(data){if(data.data.advance_amount>0){advancePaymentDetails=data;showAdvancePayBranchScreen();}else createBookingOnly();}function getQuantity(){let totalQuantity=0;bookingList.forEach((v,k)=>{totalQuantity+=v.packs;});return totalQuantity;}function proceedToBranchAdvancePaymentCheckout(data){const options={key:razorPayApiKey,order_id:data.data.razor_pay_order_id,amount:data.data.advance_amount*100,currency,name:'Barbeque Nation',image:'/themes/custom/bbq_nation/assets/images/bbqn-logo.svg',handler:((transaction)=>{checkPaymentStatus(transaction);})};window.rzpay=new Razorpay(options);rzpay.open();}function checkPaymentStatus(transaction){advanceTransactionDetails=transaction;let updateAdvanceResPayment={'razor_pay_payment_id':transaction?transaction.razorpay_payment_id:undefined,'razor_pay_order_id':transaction?transaction.razorpay_order_id:undefined,'razorpay_signature':transaction?transaction.razorpay_signature:undefined,'payment_gateway':transaction?'RAZOR_PAY':undefined};bookingHttpRequest(URL.UPDATE_ADV_RES_PAYMENT,REQUEST_METHODS.POST,updateAdvanceResPayment,updateAdvanceResPaymentConstant);}function completeAdvancePayBookingCheckout(advanceBookingId){let updateAdvanceResPayment={'booking_id':advanceBookingId,'razor_pay_order_id':advanceTransactionDetails?advanceTransactionDetails.razorpay_order_id:undefined};bookingHttpRequest(URL.UPDATE_ADV_RES_PAYMENT,REQUEST_METHODS.POST,updateAdvanceResPayment,updateAdvanceResPaymentOnCompleteConstant);}function createBookingOnly(advancePay=false){let url;let method;if(rescheduledBookingId){url=URL.BOOKING_RESCHEDULE;method=REQUEST_METHODS.PUT;}else{url=URL.CREATE_BOOKING;method=REQUEST_METHODS.POST;}if(advancePay)bookingHttpRequest(url,method,new CreateBooking(),createBookingWithAdvanceConstant);else bookingHttpRequest(url,method,new CreateBooking(),createBookingConstant);}$('.reservation__success__advance a').click(function(){$('#advance-pay').show();$('#advance-amount').val(billAmount);});$('#advance-amount').click(()=>{$('#booking-confirmed-pay-advance-amount').prop('disabled',true);});$('#booking-confirmed-pay-advance-amount').click((e)=>{e.preventDefault();if(isPayBillPage())if(getBookingTotal())generatePayBillRazorPayOrder();else completeBookingCheckout();else generateRazorPayOrder();});function generateRazorPayOrder(){const confirmedAdvanceAmount=parseFloat($('#advance-amount').val());bookingHttpRequest(URL.CREATE_BOOKING_RAZORPAY_ORDER,REQUEST_METHODS.POST,{'booking_id':bookingId,'amount':confirmedAdvanceAmount,'currency':currency},payAdvanceAmountConstant);}function generatePayBillRazorPayOrder(){let totalDisc=0;var finalPayable=0;totalDisc=getTotalDiscount();if(totalDisc>0||voucherDiscountApplied)finalPayable=getBookingTotal().toFixed(2);else finalPayable=PROPS.NET_PAYABLE;const confirmedAdvanceAmount=finalPayable;let bookingDetailsToGenerateRazorPay={'booking_id':bookingId,'amount':confirmedAdvanceAmount,'currency':currency};if(isPayBillPage())bookingDetailsToGenerateRazorPay={...bookingDetailsToGenerateRazorPay,...{loyalty_points:applyLoyaltyPoints?Math.ceil(loyaltyPointsApplied):undefined}};bookingHttpRequest(URL.CREATE_BOOKING_RAZORPAY_ORDER,REQUEST_METHODS.POST,bookingDetailsToGenerateRazorPay,payAdvanceAmountConstant);}$('#booking-confirmation-done').click((e)=>{e.preventDefault();e.stopPropagation();if(!isProfilePage())window.location.href='/profile#reservations';else window.location.reload();});function showBookingSuccessScreen(data,hidepayment=false){bookingData=data;bookingId=data.booking_id;billAmount=data.bill_total;Moengage.track_event("Reservation_Status",{"Mobile":localStorage.getItem('mobile_number'),"Login_Type":localStorage.getItem('email'),"Location":data.branch_name,"Booking_id":bookingId,"Reservation_booked_Status":"Success"});let voucherHTML='';let couponHTML='';let voucherApplied=false;let couponApplied=false;booking_info.reservationDate=getFormattedDate(selectedReservationDate);$('#booking-id').text(bookingId);$('#reservation-info').hide();$('#advance-pay-branch').hide();$('#confirm-advance-pay-branch').hide();$('#retry-advance-pay-branch').hide();$('#refund-advance-pay-branch').hide();$('#reservation__success').show();$('#booking-confirmation-buffet-items').html(getBookingConfirmedItemsHtml(data.booking_details));if(data.loyalty_points_amount&&data.loyalty_points_amount>0)$('#booking-confirmation-loyalty-points').text(data.loyalty_points_amount.toFixed(2));else $('#booking-confirmation-loyalty-points-block').hide();if(data.voucher_details&&data.voucher_details.length>0){data.voucher_details.forEach((voucher)=>{if(voucher.voucher_type=='GV'){voucherApplied=true;if(voucher.pax_applicable&&voucher.pax_applicable>0)voucherHTML+=`<div class="reservation__success__points row align-center space-between applied-vouchers-list">
                          <div class="reservation__success__left__no__logo">${voucher.voucher_code}</div>
                          <div class="reservation__success__right"> - ${voucher.pax_applicable} ${' '} Packs</div>
                        </div>`;else voucherHTML+=`<div class="reservation__success__points row align-center space-between applied-vouchers-list">
                          <div class="reservation__success__left__no__logo">${voucher.voucher_code}</div>
                          <div class="reservation__success__right"> ${voucher.amount} </div>
                        </div>`;}else{if(voucher.voucher_type=='GC'){couponApplied=true;couponHTML+=`<div class="reservation__success__points row align-center space-between applied-coupon-list">
                          <div class="reservation__success__left__no__logo">${voucher.voucher_code}</div>
                          <div class="reservation__success__right"> ${voucher.amount} </div>
                        </div>`;}}});if(voucherApplied)$('#booking-confirmation-vouchers').html(voucherHTML);else $('#booking-confirmation-vouchers-block').hide();if(couponApplied)$('#booking-confirmation-coupon').html(couponHTML);else $('#booking-confirmation-coupon-block').hide();}else{$('#booking-confirmation-vouchers-block').hide();$('#booking-confirmation-coupon-block').hide();}$('#booking-confirmed-bill-total').text(billAmount.toFixed(2).toLocaleString("en"));$('#booking-confirmed-branch-name').text(`get together @ ${data.branch_name}`);$('#booking-confirmed-reservation-date').html(`<span></span>${getFormattedDate(selectedReservationDate)}`);$('#booking-confirmation-navigation').html(`<a class="reservation__success__navigation" href=${URL.GOOGLE_MAPS}${data.lat},${data.long} target="_blank">nav</a>`);$('#booking-confirmation-call').html(`<a class="reservation__success__contact" href="tel:${data.branch_contact_no}">call</a>`);$('.reservation__success__details').css('background-image',`url(${data.branch_image})`);$('#advance-pay').hide();$('#advance-amount-block').hide();}$('#booking-confirmation-special-instructions').click(function(){$('#special-request').show();bookingHttpRequest(URL.GET_OCCASION_JOINED_BY,REQUEST_METHODS.GET,undefined,getOccasionJoinedByConstant);});$('#request-close').click(function(){$('#special-request').hide();});$('#update-special-instructions').click((e)=>{const occasion=$('input[name=occasion]:checked').attr('id').substr(9);const joinedBy=$('input[name=joined-by]:checked').attr('id').substr(10);const specialInstructions=$('#booking-special-instructions').val();bookingHttpRequest(URL.UPDATE_OCCASION_JOINED_BY_SPECIAL_INSTRUCTIONS,REQUEST_METHODS.PUT,{'booking_id':bookingId,'occasion_id':occasion?[occasion]:undefined,'joined_by':joinedBy?[joinedBy]:undefined,'special_note':specialInstructions?specialInstructions:undefined},updateSpecialInstructionsConstant);});function cleanup(){showTotalVoucherAndCorporate(false);bookingList=new Map();appliedCoupon=undefined;couponUsed=undefined;corporateEmail=undefined;corporateVerified=false;corporateOtpId=undefined;removeCorporateOffer();$('#booking-sub-total').html(0);$('#booking-tax-details').empty();$('#booking-total').html(0);$('#booking-applied-vouchers').empty();PROPS.TAX_AMOUNT=undefined;}function disableOrEnableReserveButton(){if(selectedBranchId&&selectedBranchId!==0&&selectedReservationDate&&selectedSlotId&&selectedSlotId!==0)enableReserveButton();else disableReserveButton();}function disableReserveButton(){$('#reserve-button').prop('disabled',true);}function enableReserveButton(){$('#reserve-button').prop('disabled',false);}$('#reserve-button').click((e)=>{e.stopPropagation();e.preventDefault();if($(e.target).hasClass('reservation-button-scroll-top'))$('html, body').animate({scrollTop:0},'swing');else if(userId===0||!userId){saveDataInLocalStorage();loginLink();}else{$('.reservation--curtain').addClass('reservation--visible');setBranchDateAndSlot();updateMenuListing(selectedBranchId);Moengage.track_event("Reservation",{"Mobile_Number":localStorage.getItem('mobile_number'),"Login_Type":localStorage.getItem('email'),"Location":$("#initial-booking-form .select2-selection__rendered").attr("title"),"Calendar":getFormattedReservationDate(selectedReservationDate),"Time":selectedReservationTime.toString(),"Reserve_Button":"Clicked"});PROPS.HIDE_LOYALTY_BLOCK=false;getUserLoyaltyPoints();}});function getUserLoyaltyPoints(){bookingHttpRequest(URL.GET_LOYALTY_EXCHANGE_RATE,REQUEST_METHODS.GET,{amount:1,currency},getLoyaltyExchangeRateUrlConstant);}$('.branch-dropdown').on('select2:selecting',(e)=>{selectedBranchId=e.params.args.data.id;if(jQuery('option#option-'+selectedBranchId).length>0&&jQuery('option#option-'+selectedBranchId)[0].getAttribute('data-international')==1)$.get({url:branchUrlByStoreCodeUrl+selectedBranchId,headers:getHeaders(),success(data){window.location.href=data;}});else{if(selectedBranchId!=='0'){updateBookingInformation(getFormattedReservationDate(selectedReservationDate));disableOrEnableReserveButton();}else{selectedBranchId=undefined;disableOrEnableReserveButton();}updateMenuListing(selectedBranchId);}});function updateMenuListing(storeId){$.ajax({url:'/views/ajax',type:'POST',data:{view_name:'branch_menu',view_display_id:'branch_menu_store',view_args:(storeId!==0)?storeId:''},dataType:'json',success:function(response){if(response[3]!==undefined){var viewHtml=response[3].data;var settings=response[0].settings;$('#menu-listing').html(viewHtml);var imageCountmobMenu=$('.branch-menu-booking-row .views-field-branch-menu-image-target-id .field-content .colorbox').length;if(!imageCountmobMenu)$('#menu-listing').html('No menu available.');else{var imageCountMenu=imageCountmobMenu-5;for(var i=0;i<=imageCountmobMenu;i++)$('.branch-menu-booking-row .views-field-branch-menu-image-target-id .field-content a').eq(i).addClass('cboxElement colorbox-branch-menu');for(var j=0;j<=4;j++)$('.branch-menu-booking-row .views-field-branch-menu-image-target-id .field-content a').eq(j).addClass('s-gallery-item');$('.branch-menu-booking-row .views-field-branch-menu-image-target-id .field-content a').eq(0).addClass('s-gallery-item--first').append('<span>'+imageCountmobMenu+' PHOTOS </span>');$('.branch-menu-booking-row .views-field-branch-menu-image-target-id .field-content a').eq(4).addClass('s-gallery-item s-gallery-item--last').wrap('<div class= "wrapper-right"> </div>');if(imageCountmobMenu>5)$('.branch-menu-booking-row .views-field-branch-menu-image-target-id .field-content a').eq(4).append('<span>'+imageCountMenu+' PHOTOS </span>');$('head').append(response[1].data);$('head').append(response[2].data);if(!$.isFunction($.colorbox)||typeof settings.colorbox==='undefined')return;if(settings.colorbox.mobiledetect&&window.matchMedia){var mq=window.matchMedia('(max-device-width: '+settings.colorbox.mobiledevicewidth+')');if(mq.matches){$.colorbox.remove();return;}}settings.colorbox.rel=function(){return $(this).data('colorbox-gallery');};$(once('init-colorbox','.colorbox-branch-menu')).each(function(){var extendParams={photo:true};var title=$(this).attr('title');if(title)extendParams.title=Drupal.checkPlain(title);$(this).colorbox($.extend({},settings.colorbox,extendParams));});$('.colorbox-branch-menu').colorbox({onComplete:function(e){var focus=$('#cboxContent').find('#cboxPrevious').css('display')!=='none'?$('#cboxContent').find('#cboxPrevious'):$('#cboxContent').find('#cboxClose');focus.focus();$('#cboxContent').on('keydown',function(e){var keyCode=e.keyCode||e.which;var firstElement=$('#cboxContent').find('#cboxPrevious').last().is(':focus');var lastElement=$('#cboxContent').find('#cboxClose').first().is(':focus');if(keyCode===9&&!e.shiftKey&&lastElement){e.preventDefault();$('#cboxContent').find('#cboxPrevious').first().focus();}else{if(keyCode===9&&e.shiftKey&&firstElement){e.preventDefault();$('#cboxContent').find('#cboxClose').first().focus();}}});}});}}},error:function(data){$('#menu-listing').html('No menu available.');}});}function setBranchImageAndAmenities(){$('#branch-background-image').attr('src',preferredBranch.branchImages);const amenities=$('.amenity-images');let amenitiesHtml='';preferredBranch.amenities.forEach((amenity)=>{amenitiesHtml+=`<div class="amenity-icon">
                        <img src="${amenity.image}" alt="">
                      </div>`;});amenities.html(amenitiesHtml);}$('.slot-dropdown').on('select2:selecting',(e)=>{selectedSlotId=parseInt(e.params.args.data.id,10);selectedReservationTime=e.params.args.data.element.label;selectedSlotName=e.params.args.data.text;$('#booking-slot-value').text(selectedSlotName);$('.slot-dropdown').val(selectedSlotId).trigger('change');refreshData();});$('#branch-details-menu-slot').on('select2:selecting',(e)=>{branchDetailSelectedSlotId=parseInt(e.params.args.data.id,10);branchDetailSelectedReservationTime=e.params.args.data.element.label;branchDetailSelectedSlotName=e.params.args.data.text;updateBranchMenu();});$('.booking-tomorrow').click(()=>{$('.booking-datepicker').datepicker('setDate',getDatePickerFormattedDate(tomorrowDate));updateReservationDate(tomorrowDate.clone());});$('.booking-today').click(()=>{$('.booking-datepicker').datepicker('setDate',getDatePickerFormattedDate(todayDate));updateReservationDate(todayDate.clone());});$('#branch-details-menu-today').click(()=>{updateReservationDateInBranchDetail(todayDate.clone());updateBranchDatePicker();});$('#branch-details-menu-tomorrow').click(()=>{updateReservationDateInBranchDetail(tomorrowDate.clone());updateBranchDatePicker();});function updateBranchDatePicker(){$('#branch-details-menu-date-picker').datepicker('setDate',getDatePickerFormattedDate(branchDetailSelectedReservationDate));}$('.lunch').click(()=>{if(selectedDiningType!==lunchConstant){selectedDiningType=lunchConstant;setDiningType(selectedDiningType,'.lunch','.dinner');updateBookingInformation(getFormattedReservationDate(selectedReservationDate));disableOrEnableReserveButton();}});$('.dinner').click(()=>{if(selectedDiningType!==dinnerConstant){selectedDiningType=dinnerConstant;setDiningType(selectedDiningType,'.lunch','.dinner');updateBookingInformation(getFormattedReservationDate(selectedReservationDate));disableOrEnableReserveButton();}});$('#branch-details-menu-lunch').click(()=>{if(branchDetailSelectedDiningType!==lunchConstant){branchDetailSelectedDiningType=lunchConstant;setDiningType(branchDetailSelectedDiningType,'#branch-details-menu-lunch','#branch-details-menu-dinner');getBranchSlot();}});$('#branch-details-menu-dinner').click(()=>{if(branchDetailSelectedDiningType!==dinnerConstant){branchDetailSelectedDiningType=dinnerConstant;setDiningType(branchDetailSelectedDiningType,'#branch-details-menu-lunch','#branch-details-menu-dinner');getBranchSlot();}});function setDiningType(value,lunchSelector,dinnerSelector){if(value===lunchConstant)$(lunchSelector).prop('checked',true);else{if(value===dinnerConstant)$(dinnerSelector).prop('checked',true);}}function loaderStop(){$('.reservation__block').removeClass('disable-click-event');$('.fakeLoader').removeClass('display-block');$('.fakeLoader').addClass('hide');}$(document).click((e)=>{const branchInfoCard=$('.basic-info__form');if(!$(e.target).parents('.basic-info__form').length&&branchInfoCard.is(':visible')){branchInfoCard.hide();$('.basic-info__card').show();}});function loaderStart(){$('.reservation__block').addClass('disable-click-event');$('.fakeLoader').removeClass('hide');$('.fakeLoader').addClass('display-block');}function bookingHttpRequest(url,requestMethod=REQUEST_METHODS.GET,postData,type,event){$.ajax({dataType:'json',method:requestMethod,url,data:requestMethod!==REQUEST_METHODS.GET?JSON.stringify(postData):postData,beforeSend:function(){loaderStart();},complete:function(){loaderStop();},headers:getHeaders(),success(data){if(type===singleBranchConstant)populateBranches(data);else if(type===branchSlotConstant)updateBranchSlot(data);else if(type===branchSlotCapacityConstant)checkBranchSlotCapacity(data);else if(type===allBranchesConstant)populateBranchList(data);else if(type===buffetConstant)populateBuffetList(data);else if(type===branchMenuConstant)populateMenuList(data,true);else if(type===corporateVerificationConstant)showCorporateOtpScreen(data);else if(type===corporateEmailOtpVerificationConstant)verifyCorporateEmailOtp(data);else if(type===showCouponsConstant)populateCouponsAndVouchers(data,PROPS.COUPON_CODE);else if(type===applyCouponsConstant)if(data&&data.message_type=="success"){if(appliedCoupon)$('.booking-remove-coupon').trigger('click');appliedCoupon=couponUsed;$('#booking-applied-vouchers').append(appliedVoucherHtml(couponUsed,PROPS.COUPON_CODE));buildVoucherAndCouponHtml(PROPS.COUPON_CODE);$('#coupons-vouchers-close').trigger('click');}else{if(data&&data.message_type=="failed")if(data.message)toastr.error(data.message);else toastr.error('Coupon cannot be applied.');}else if(type===showVouchersConstant)populateCouponsAndVouchers(data,PROPS.VOUCHER_CODE);else if(type===corporateOffersConstant)populateCouponsAndVouchers(data,corporateOffersConstant);else if(type===createBookingConstant)handleBooking(data);else if(type===createBookingWithAdvanceConstant){advanceBookingData=data;handleBookingWithAdvance(data);}else if(type===payAdvanceAmountConstant)proceedToBookingCheckout(data);else if(type===payAdvanceAmountBranchConstant)proceedToBranchAdvancePaymentCheckout(data);else if(type===checkAdvanceAmountBranchConstant)checkAdvancePaymentRequired(data);else if(type===completeBookingConstant){toastr.success('Payment completed successfully!');if(isPayBillPage())showBillingPaymentSuccessScreen();else showBookingSuccessScreen(data,true);}else if(type===completeBookingWithAdvanceConstant)completeAdvancePayBookingCheckout(data.booking_id);else if(type===getOccasionJoinedByConstant)buildOccasionJoinedByHtml(data);else if(type===updateSpecialInstructionsConstant){toastr.success('Updated successfully');$('#special-request').hide();}else if(type===getLoyaltyExchangeRateUrlConstant)updateUserLoyaltyPoints(data);else if(type===TYPE.GET_BILLING_DETAILS)setBillingData(new BillingDetails(data));else if(type===updateAdvanceResPaymentOnCompleteConstant)if(data&&data.message_type=="Success"&&data.data.razor_pay_payment_status=="success")showBookingSuccessScreen(advanceBookingData,true);else if(data&&data.message_type=="Success"&&data.data.razor_pay_payment_status=="Refund")showRefundInitiatedScreen(advanceBookingData);else{if(data&&data.message_type=="Failed"){Moengage.track_event("Reservation_Status",{"Reservation_booked_Status":"Failed","Error":"Unable to process your request, please try again later."});toastr.error("Unable to process your request, please try again later.");}}else if(type===reservationRulesConstant)if(data&&data.message_type=="success")proceedWithBooking(data);else toastr.error("Unable to process your request, please try again later.");else{if(type===updateAdvanceResPaymentConstant)if(data&&data.message_type=="Success")createBookingOnly(true);else showRetryAdvancePayBranchScreen();}},error(data){if(type===corporateVerificationConstant)showCorporateOtpScreen(data,true);else if(type===corporateEmailOtpVerificationConstant)invalidCorporateEmailOtp();else if(type===createBookingConstant){Moengage.track_event("Reservation_Status",{"Reservation_booked_Status":"Failed","Error":data.responseJSON.fieldErrors[0].message});toastr.error(data.responseJSON.fieldErrors[0].message);}else if(type===createBookingWithAdvanceConstant||type===completeBookingWithAdvanceConstant)completeAdvancePayBookingCheckout('failed');else if(type===completeBookingConstant)toastr.error('Payment failed, Please contact customer care.');else if(type===showCouponsConstant)toastr.error(data.responseJSON.fieldErrors[0].message);else if(type===applyCouponsConstant)if(data.responseJSON.fieldErrors[0].message)toastr.error(data.responseJSON.fieldErrors[0].message);else toastr.error(data.fieldErrors[0].message);else if(type===showVouchersConstant)toastr.error(data.responseJSON.fieldErrors[0].message);else if(type===corporateOffersConstant)toastr.error(data.responseJSON.fieldErrors[0].message);else if(type===buffetConstant)clearMenu();else if(type===TYPE.GET_BILLING_DETAILS)toastr.error('We are unable to fetch the bill. Please try again.');else if(data&&data.responseJSON&&data.responseJSON.fieldErrors&&data.responseJSON.fieldErrors[0]&&data.responseJSON.fieldErrors[0].message)toastr.error(data.responseJSON.fieldErrors[0].message);else toastr.error("Unable to process your request");}});}function showBillingPaymentSuccessScreen(){$('.billing-container').hide();$('.payment-successful-wrapper').show();}function updateUserLoyaltyPoints(data){loyaltyPoints=data.available_points;loyaltyExchangeRate=data.redeem_amount/data.redeemable_points;calculateLoyaltyPoints();}function proceedToBookingCheckout(data){const options={key:data.key,order_id:data.order_id,amount:data.amount,currency:data.currency,name:'Barbeque Nation',image:'/themes/custom/bbq_nation/assets/images/bbqn-logo.svg',handler:((transaction)=>{completeBookingCheckout(transaction);}),prefill:{"contact":data.mobile_number,"email":data.email}};window.rzpay=new Razorpay(options);rzpay.open();}function buildOccasionJoinedByHtml(data){if(!specialInstructionsBuilt){let occasionHtml='';let joinedByHtml='';data.celebrating_for.forEach((occasion)=>{occasionHtml+=getOccasionJoinedByHtml(occasion.occasion_id,'occasion',occasion.occasion_name);});data.joined_by.forEach((joinedBy)=>{joinedByHtml+=getOccasionJoinedByHtml(joinedBy.relationship_id,'joined-by',joinedBy.relationship_name);});$('#occasion-list').html(occasionHtml);$('#joined-by-list').html(joinedByHtml);specialInstructionsBuilt=true;}}$('#advance-amount').on('input',(e)=>{const amount=parseFloat(e.currentTarget.value);if(amount<=billAmount&&amount>0)$('#booking-confirmed-pay-advance-amount').prop('disabled',false);else $('#booking-confirmed-pay-advance-amount').prop('disabled',true);});function saveDataInLocalStorage(){const bookingDetails={branchId:selectedBranchId,slotId:selectedSlotId,slotName:selectedSlotName,diningType:selectedDiningType,reservationDate:getFormattedReservationDate(selectedReservationDate),reservationTime:selectedReservationTime,preferredBranch,branchList};localStorage.setItem('booking_details',JSON.stringify(bookingDetails));booking_info.reservationDate=getFormattedReservationDate(selectedReservationDate);}function getFormattedDate(d){return d.format('Do MMMM, YYYY');}function checkLocalStorageDetails(){const localBookingDetails=JSON.parse(localStorage.getItem('booking_details'));if(localBookingDetails&&localBookingDetails.branchId&&localBookingDetails.branchId!==0&&localBookingDetails.slotId&&localBookingDetails.slotName&&localBookingDetails.preferredBranch&&localBookingDetails.branchList&&localBookingDetails.reservationDate){selectedBranchId=localBookingDetails.branchId;selectedSlotId=localBookingDetails.slotId;selectedReservationTime=localBookingDetails.reservationTime;selectedSlotName=localBookingDetails.slotName;selectedDiningType=localBookingDetails.diningType;selectedReservationDate=moment(localBookingDetails.reservationDate);preferredBranch=localBookingDetails.preferredBranch;branchList=localBookingDetails.branchList;localStorage.removeItem('booking_details');return true;}return false;}function getBranchList(){if(branchList.length===0){let payload={"type":"reservation"};bookingHttpRequest(URL.GET_ALL_BRANCHES,REQUEST_METHODS.POST,payload,allBranchesConstant);}else populateBranchList(branchList);}function updateReservationDate(date){let selectedDate;if(date instanceof moment)selectedDate=date;else selectedDate=moment(date,'DD/MM/YYYY');if(!selectedDate.isSame(selectedReservationDate,'day')){selectedReservationDate=selectedDate;setTodayTomorrowCheckBox();updateBookingInformation(selectedDate);booking_info.reservationDate=getFormattedReservationDate(selectedReservationDate);}}function updateBookingInformation(reservationDate){bookingHttpRequest(URL.GET_NEARBY_BRANCHES,REQUEST_METHODS.POST,new SlotPostData(getFormattedReservationDate(reservationDate)),singleBranchConstant);}function getNearbyByBranches(){const reservationDate=getFormattedReservationDate(todayDate);updateBookingInformation(reservationDate);}function populateBranchList(data){if(branchList.length===0)branchList=data;const branchListValues=[];data.data.forEach((city)=>{if(city.branches.length>0)branchListValues.push(branchListSelect2Values(city));});$('.branch-dropdown').select2({data:branchListValues,matcher:matchBranch});if(selectedBranchId&&populateNearbyBranches)getNearbyByBranches();}function matchBranch(params,data){if($.trim(params.term)==='')return data;if(typeof data.children==='undefined')return null;if(data.text.toUpperCase().indexOf(params.term.toUpperCase())>-1)return $.extend({},data,true);const filteredChildren=[];$.each(data.children,function(idx,child){if(child.text.toUpperCase().indexOf(params.term.toUpperCase())===0)filteredChildren.push(child);});if(filteredChildren.length){const modifiedData=$.extend({},data,true);modifiedData.children=filteredChildren;return modifiedData;}return null;}function branchListSelect2Values(city){return{id:city.city_code,text:city.city_name,children:city.branches.map((branch)=>{return{id:branch.branch_id,text:branch.branch_name};})};}function refreshData(){bookingHttpRequest(URL.BUFFET_LIST,REQUEST_METHODS.POST,new MenuPostData(),buffetConstant);cleanup();}function redirectToHomePage(time=500){setTimeout(function(){window.location.href='/';},time);}function getOccasionJoinedByHtml(id,name,label){return `<input id="${name}-${id}" name="${name}" type="radio">
          <label for="${name}-${id}">${label}</label>`;}function getVegNonVegClass(foodType){let foodTypeClass;if(foodType==='NONVEG')foodTypeClass='nonveg';else{if(foodType==='VEG')foodTypeClass='veg';}return foodTypeClass;}function calculateTaxAmount(){let totalTax=0;let taxHtml='';let amount=getSubTotal();let serviceChargeCal=0;if(preferredBranch.serviceCharge)serviceChargeCal=amount*(preferredBranch.serviceCharge/100);preferredBranch.taxDetails.forEach((tax)=>{const taxAmount=(amount+serviceChargeCal)*(tax.taxPercentage/100);taxHtml+=getTaxHtml(tax.tax,roundTaxAmount(taxAmount));totalTax+=taxAmount;});if(preferredBranch.serviceCharge){const serviceChargeAmount=amount*(preferredBranch.serviceCharge/100);totalTax+=serviceChargeAmount;taxHtml+=getTaxHtml('Service Charge',roundTaxAmount(serviceChargeAmount));}PROPS.TAX_AMOUNT=parseFloat(roundTaxAmount(totalTax));$('#booking-tax-details').html(taxHtml);}function calculateVoucherMealDiscount(){let voucherMealDiscount=0;let totalVoucherBaseValueWithPax=0;let totalVoucherValueWithPax=0;let totalVouchers=0;if(voucherDiscountAppliedWithPax){totalVoucherBaseValueWithPax=voucherDiscountAppliedWithPax+(voucherDiscountAppliedWithPax*0.05);totalVoucherValueWithPax=totalVoucherBaseValueWithPax-((100*totalVoucherBaseValueWithPax)/105);totalVouchers=totalVoucherBaseValueWithPax-totalVoucherValueWithPax;voucherMealDiscount=PROPS.REMOVED_PAX_AMOUNT-totalVouchers;}return parseFloat(voucherMealDiscount)>0?parseFloat(voucherMealDiscount):0;}function reCalculateTaxAmount(){let totalDisc=0;totalDisc=getTotalDiscount();if(totalDisc==0){let amount=getGstBaseAmount();if(PROPS.VAT_AMOUNT)PROPS.VAT_AMOUNT=PROPS.START_VAT_AMOUNT;PROPS.ADDITIONAL_TAXES=PROPS.VAT_AMOUNT+PROPS.INITIAL_CESS;PROPS.CGST_AMOUNT=parseFloat(roundTaxAmount(PROPS.INITIAL_GST_BASE_AMOUNT*(PROPS.CGST_PER/100)));PROPS.SGST_AMOUNT=parseFloat(roundTaxAmount(PROPS.INITIAL_GST_BASE_AMOUNT*(PROPS.SGST_PER/100)));PROPS.TAX_AMOUNT=PROPS.CGST_AMOUNT+PROPS.SGST_AMOUNT+PROPS.ADDITIONAL_TAXES;if(PROPS.SERVICE_CHARGE)PROPS.SERVICE_CHARGE=PROPS.INITIAL_SERVICE_CHARGE;PROPS.SUB_TOTAL=PROPS.INITIAL_SUB_TOTAL;PROPS.ADDITIONAL_DISCOUNTS=PROPS.INITIAL_ADDITIONAL_DISCOUNTS;}if(totalDisc>0){PROPS.ADDITIONAL_DISCOUNTS=0;reCalculateServiceChargeAmount();}}function reCalculateServiceChargeAmt(){let servchargePer=0;let totalDisc=0;let totalAmtAfterDection=0;totalDisc=getTotalDiscount();let amount=PROPS.INITIAL_GST_BASE_AMOUNT-PROPS.INITIAL_SERVICE_CHARGE;servchargePer=Math.round(PROPS.INITIAL_SERVICE_CHARGE*100/(amount-PROPS.INITIAL_SERVICE_CHARGE));totalAmtAfterDection=PROPS.INITIAL_GST_BASE_AMOUNT-PROPS.INITIAL_SERVICE_CHARGE-totalDisc;PROPS.SERVICE_CHARGE=parseFloat(roundTaxAmount(totalAmtAfterDection*(servchargePer/100)));PROPS.ADDITIONAL_TAXES=PROPS.VAT_AMOUNT+PROPS.CESS+PROPS.SERVICE_CHARGE;}function calculateGstRatio(){let gstRatio=0;let vatRatio=0;gstRatio=getNewGstBaseAmount()/getTaxBaseAmt();vatRatio=PROPS.INITIAL_VAT_AMOUNT/getTaxBaseAmt();var taxRatio=new Map();taxRatio.set('gstRatio',gstRatio);taxRatio.set('vatRatio',vatRatio);return taxRatio;}function getTaxableGstAmount(){let gst_ratio=calculateGstRatio();let dis=getTotalDiscount();let new_gst_amt=getNewGstBaseAmount();return(new_gst_amt-(dis*gst_ratio.get('gstRatio')));}function getTaxableVatAmount(){let gst_ratio=calculateGstRatio();let dis=getTotalDiscount();return(PROPS.INITIAL_VAT_AMOUNT-(dis*gst_ratio.get('vatRatio')));}function reCalculateServiceChargeAmount(){let dis=getTotalDiscount();let new_service_amt=0;new_service_amt=parseFloat(roundTaxAmount((getServiceChargePer()*0.01)*(getTaxableGstAmount()+getTaxableVatAmount())));PROPS.CGST_AMOUNT=parseFloat(roundTaxAmount(PROPS.CGST_PER*(getTaxableGstAmount()+new_service_amt)*0.01));PROPS.SGST_AMOUNT=parseFloat(roundTaxAmount(PROPS.SGST_PER*(getTaxableGstAmount()+new_service_amt)*0.01));PROPS.SERVICE_CHARGE=new_service_amt;PROPS.VAT_AMOUNT=parseFloat(roundTaxAmount(PROPS.VAT_PER*getTaxableVatAmount()*0.01));if(PROPS.HIDE_LOYALTY_BLOCK||couponDiscountApplied)if(PROPS.HIDE_LOYALTY_BLOCK)PROPS.SUB_TOTAL=getTaxableGstAmount()+getTaxableVatAmount()+dis+loyaltyDiscountApplied;else if(!appliedCoupon)PROPS.SUB_TOTAL=getTaxableGstAmount()+getTaxableVatAmount()+dis+couponDiscountApplied;else PROPS.SUB_TOTAL=getTaxableGstAmount()+getTaxableVatAmount()+dis;else PROPS.SUB_TOTAL=getTaxableGstAmount()+getTaxableVatAmount()+dis;PROPS.ADDITIONAL_TAXES=PROPS.VAT_AMOUNT+PROPS.CESS;PROPS.TAX_AMOUNT=PROPS.CGST_AMOUNT+PROPS.SGST_AMOUNT+PROPS.ADDITIONAL_TAXES+PROPS.SERVICE_CHARGE;}function getTotalDiscount(){let totalDiscount=0;let loyaltyPointsValue=0;let discountValue=0;if(applyLoyaltyPoints&&PROPS.HIDE_LOYALTY_BLOCK==false)loyaltyPointsValue=loyaltyDiscountApplied;if(appliedCoupon)discountValue=couponDiscountApplied;totalDiscount=loyaltyPointsValue+discountValue;return totalDiscount;}function getTaxBaseAmt(){let gstBaseAmt=getNewGstBaseAmount();let vatBaseAmt=PROPS.INITIAL_VAT_AMOUNT;let taxBaseAmt=0;taxBaseAmt=parseFloat(gstBaseAmt+vatBaseAmt);return taxBaseAmt;}function getNewGstBaseAmount(){let newGstBaseamt=0;let servicePer=0;let amount=PROPS.INITIAL_GST_BASE_AMOUNT;servicePer=getServiceChargePer();newGstBaseamt=(100*amount)/(100+servicePer);return newGstBaseamt;}function getServiceChargePer(){let amount=PROPS.INITIAL_GST_BASE_AMOUNT;return Math.round(PROPS.INITIAL_SERVICE_CHARGE*100/(amount+PROPS.INITIAL_VAT_AMOUNT-PROPS.INITIAL_SERVICE_CHARGE));}function getTaxHtml(label,amount){return `<div class="gst">
              <h5>${label}</h5>
              <span>${buffetCurrency}${amount}</span>
            </div>`;}function roundTaxAmount(amount){return amount.toFixed(2);}function getFormattedSlotTime(time){const H=+time.substr(0,2);let h=H%12||12;h=(h<10)?('0'+h):h;const ampm=(H<12||H===24)?'AM':'PM';return h+time.substr(2,3)+ampm;}function generateMenuListHtml(buffetItems){let buffetItemsHtml='';buffetItems.forEach((item)=>{buffetItemsHtml+=`<div class="reservation__item-menu__block">
                          <div class="accordion" id="menu__accordion">
                            <div class="accordion-panel">
                                <div class="accordion-header">
                                    ${item.name}
                                    <span class="item__count">${item.menuItems.length} Items</span>
                                </div>
                                <div class="accordion-body">${generateMenuItemHtml(item.menuItems)}</div>
                            </div>
                          </div>
                        </div>`;});return buffetItemsHtml;}function generateMenuItemHtml(menuItems){let menuItemHtml='';menuItems.forEach((item)=>{let foodTypeClass=getVegNonVegClass(item.type);menuItemHtml+=`<div class="menu__item__card">
                        <div class="menu__item__image">
                            <img alt="" data-src="${item.image}" class="lazyload">
                        </div>
                        <div class="menu__item__content">
                          <div class="menu__item__title">
                            <div class="menu__item__category ${foodTypeClass}"></div>
                            <div class="menu__item__name">${item.name}</div>
                            <div class="menu__item__price">${getCurrencyCode(item.currency)}${item.default_price}</div>
                            ${buildTagHtml(item)}
                          </div>
                          <div class="menu__item__details">${item.description}</div>
                        </div>
                    </div>`;});return menuItemHtml;}function buildTagHtml(item){if(item.tags&&item.tags.image)return `<div class="menu__item__type">
                <img alt="" src="${item.tags.image}">
              </div>`;return '';}function voucherAndCouponItemHtml(title,voucherType,code,currency,amount,tempSubTotal,type,applicability,description){let couponClass='booking-apply-coupon';let couponText;if(voucherType===PROPS.COUPON_CODE&&type&&type===corporateOffersConstant){couponText='Apply coupon';voucherType=corporateOffersConstant;if(appliedCorporateCoupon)if(code===appliedCorporateCoupon.barCode){couponClass='coupon-applied';couponText='Applied';}else couponClass+=' anchor-disabled';}else if(voucherType===PROPS.COUPON_CODE){couponText='Apply coupon';if(appliedCoupon)if(code===appliedCoupon.barCode){couponClass='coupon-applied';couponText='Applied';}else couponClass+=' anchor-disabled';}else{if(voucherType===PROPS.VOUCHER_CODE){couponText='Apply voucher';if(appliedVouchers&&appliedVouchers.length>0)appliedVouchers.forEach((voucher)=>{if(voucher.barCode===code){couponClass='coupon-applied';couponText='Applied';}});}}if(amount>tempSubTotal&&type!==PROPS.VOUCHER_CODE)if(couponClass.substr(0,14)!=='coupon-applied')couponClass+=' anchor-disabled';if(!applicability&&type!==corporateOffersConstant)couponClass='anchor-disabled';return `<div class="coupon-card row align-center space-between">
            <div class="coupon__left">
              <div class="coupon-title">${title}</div>
              <div class="coupon-description">${getCurrencyCode(currency)}${amount.toLocaleString("en")} ${' '} OFF</div>
              ${getCouponDescription(description)}
            </div>
            <div class="coupon__right">
              <div class="coupon-cta">
                <div class="${voucherType}">
                  <a id="${code}" class="${couponClass}" href="#">${couponText}</a>
                </div>
              </div>
              <div class="coupon-code hide">Code:
                <span>${code}</span>
              </div>
            </div>
          </div>`;}function handleBooking(data){bookingData=data;if(data.booking_status==='CONFIRMED')if(data.bill_total>0)showBookingSuccessScreen(data);else showBookingSuccessScreen(data,true);if(data.booking_status==='PENDING'){bookingId=data.booking_id;advanceAmount=data.advance_amount;billAmount=data.bill_total;bookingHttpRequest(URL.CREATE_BOOKING_RAZORPAY_ORDER,REQUEST_METHODS.POST,{'booking_id':bookingId,'amount':advanceAmount,'currency':currency},payAdvanceAmountConstant);}}function handleBookingWithAdvance(data){let updateBooking={'booking_id':data.booking_id,'payment_id':advanceTransactionDetails?advanceTransactionDetails.razorpay_payment_id:undefined,'payment_order_id':advanceTransactionDetails?advanceTransactionDetails.razorpay_order_id:undefined,'payment_signature':advanceTransactionDetails?advanceTransactionDetails.razorpay_signature:undefined,'payment_gateway':advanceTransactionDetails?'RAZOR_PAY':undefined};bookingHttpRequest(URL.CREATE_BOOKING,REQUEST_METHODS.PUT,updateBooking,completeBookingWithAdvanceConstant);}function completeBookingCheckout(transaction){let updateBooking={'booking_id':bookingId,'payment_id':transaction?transaction.razorpay_payment_id:undefined,'payment_order_id':transaction?transaction.razorpay_order_id:undefined,'payment_signature':transaction?transaction.razorpay_signature:undefined,'payment_gateway':transaction?'RAZOR_PAY':undefined};if(isPayBillPage())updateBooking={...updateBooking,...{voucher_details:getVoucherDetails(),loyalty_points:applyLoyaltyPoints?Math.ceil(loyaltyPointsApplied):undefined,voucher_meal_discount:calculateVoucherMealDiscount()}};bookingHttpRequest(URL.CREATE_BOOKING,REQUEST_METHODS.PUT,updateBooking,completeBookingConstant);}function getBuffetImage(buffet){let buffetImage;if(buffet.buffetCustomerType=='Child')buffetImage='/themes/custom/bbq_nation/assets/images/kid_icon.png';else if(buffet.buffetType=='VEG')buffetImage='/themes/custom/bbq_nation/assets/images/veg_icon.png';else buffetImage='/themes/custom/bbq_nation/assets/images/non_veg_icon.png';if(buffet.buffetType=='FREEDOM-1947_PAX_3')buffetImage='/themes/custom/bbq_nation/assets/images/sale.png';return buffetImage;}function getBuffetName(buffet){let buffetName=buffet.buffetName;if(buffet.buffetCustomerType=='Child'){buffetName='KID';if(multiKidsPack)buffetName+=' ('+buffet.buffetType+')';}minQtyVal='';if(buffet.minQty>1)minQtyVal=' (Min '+buffet.minQty+')';if(buffetName)return buffetName+minQtyVal;else{buffetName=buffet.buffetType;return buffetName+minQtyVal;}}function getBookingConfirmedItemsHtml(bookingDetails){let itemsHtml='';bookingDetails.forEach((item)=>{buffetList.buffetData.forEach((buffet)=>{if(item.buffet_id===parseInt(buffet.buffetId,10))itemsHtml+=getBookingConfirmedBuffetItemHtml(getBuffetImage(buffet),getBuffetName(buffet),item.packs);});});return itemsHtml;}function getBookingConfirmedBuffetItemHtml(image,name,packs){return `<div class="reservation__success__card row align-center space-between">
            <div class="reservation__success__left row align-center">
              <div class="reservation__success__image">
                <img src="${image}" alt="">
              </div>
              <div class="reservation__success__title">${name}</div>
            </div>
            <div class="reservation__success__right">
              <div class="reservation__success__count">${packs}</div>
            </div>
          </div>`;}function appliedVoucherHtml(voucher,voucherType){if(voucher){let cssClass='remove-link';let divId;let offerText='';if(voucherType===PROPS.VOUCHER_CODE){if(!voucherDiscountApplied)voucherDiscountApplied=0;if(!noOfVoucherDiscountAppliedWithPax)noOfVoucherDiscountAppliedWithPax=0;if(!voucherDiscountAppliedWithPax)voucherDiscountAppliedWithPax=0;if(voucher.paxApplicable>0){noOfVoucherDiscountAppliedWithPax+=voucher.paxApplicable;voucherDiscountAppliedWithPax+=voucher.denomination;if(!isPayBillPage())setBuffetTotal();setGstBaseAmount();}else voucherDiscountApplied+=voucher.denomination;divId=`applied-voucher-${voucher.barCode}`;cssClass+=' booking-remove-voucher';setAmountDetails(true);}else if(voucherType===PROPS.COUPON_CODE){if(!couponDiscountApplied)couponDiscountApplied=0;couponDiscountApplied+=voucher.denomination;divId=`applied-coupon-${voucher.barCode}`;cssClass+=' booking-remove-coupon';if(!isPayBillPage())setBuffetTotal();setGstBaseAmount();setAmountDetails(true);}else{if(voucherType===corporateOffersConstant){if(!couponDiscountApplied)couponDiscountApplied=0;couponDiscountApplied+=voucher.denomination;divId=`applied-coupon-${voucher.barCode}`;cssClass+=' booking-remove-corporate-coupon';if(!isPayBillPage())setBuffetTotal();setGstBaseAmount();setAmountDetails(true);}}offerText=`${getCurrencyCode(voucher.currency)} ${voucher.denomination.toLocaleString("en")} ${' '} discount on the bill`;if(voucherType===PROPS.VOUCHER_CODE)if(voucher.paxApplicable>0)offerText=`- ${voucher.paxApplicable} ${' '} Packs`;return `<div id=${divId} ${' '} class="left">
                <div class="heading row align-center">
                  <h5 class="coupon">${voucher.barCode}</h5>
                  <a href="#" id="${voucher.barCode}" class="${cssClass}">Remove</a>
                </div>
                <span>${offerText}</span>
             </div>`;}}function generateBuffetItemHtml(buffet){return `<div class="reservation__item">
            <div class="reservation__item__card">
              <div class="reservarion__image"><img data-src="${getBuffetImage(buffet)}" alt="V1" class="lazyload"></div>
                <div class="reservation__item__title">
                  <h5>${getBuffetName(buffet)}</h5>
                  <span>${getCurrencyCode(buffet.buffetCurrency)}${buffet.buffetPrice}</span>
              </div>
              <input type="hidden" id="buffet-unit-price-${buffet.buffetId}" value="${buffet.buffetPrice}" />
              <input type="hidden" id="buffet-min-qty-${buffet.buffetId}" value="${buffet.minQty}" />
              <div class="reservation__item__form-wrap">
              <form id="${buffet.buffetId}" class="form form--reservation">
                <div class="value-button decrease decrease-buffet-quantity"></div>
                <input type="text" class="buffet-quantity-${buffet.buffetId} number" value="0" readonly/>
                <div class="value-button increase increase-buffet-quantity"></div>
              </form>
              <span id="booking-buffet-total-${buffet.buffetId}" class="reservation__item__total"></span>
              </div>


            </div>
          </div>`;}function buildOtherMenu(item){return `<div class="accordion-panel">
            <div class="accordion-header">
              ${item.menu_title}
              <span class="item__count">${item.menu_items.length} Items</span>
            </div>
            <div class="accordion-body">${generateMenuItemHtml(item.menu_items)}</div>
          </div>`;}function buildBuffetMenuHtml(buffet){return `<div class="accordion-panel">
            <div class="accordion-header">
                <p class="item__header">${buffet.buffet_name}</p>
                <span class="item__count">${buffet.buffet_items.length} Items</span>
                <span class="item-price">${getCurrencyCode(buffetCurrency)}${buffet.buffet_price}</span>
            </div>
            <div class="accordion-body">${buildBuffetItems(buffet.buffet_items)}</div>
        </div>`;}function buildBuffetItems(buffetItems){let buffetItemHtml='';buffetItems.forEach((item)=>{buffetItemHtml+=`<div class="accordion-panel">
                        <div class="accordion-header">${item.name}
                            <span class="item__count">${item.menu_items.length} Items</span>
                        </div>
                        <div class="accordion-body">${generateMenuItemHtml(item.menu_items)}</div>
                      </div>`;});return buffetItemHtml;}$('.reservation__corporate-link').click(function(e){if(!isAnonymous()){e.preventDefault();if(appliedCoupon)toastr.error('You cannot apply corporate offer with coupon applied');else if(getBookingTotal()<1)toastr.error('Please add more items to apply corporate offer');else if(corporateVerified){isCorporatePageActive=true;$('#reservation-info').hide();$('#coupons-vouchers').show();let totalQuantity=0;let total=getBookingTotal();bookingList.forEach((v,k)=>{totalQuantity+=v.packs;});if(noOfVoucherDiscountAppliedWithPax)totalQuantity-=noOfVoucherDiscountAppliedWithPax;const corporateData={email:corporateEmail,packs:totalQuantity,reservation_date:getFormattedReservationDate(selectedReservationDate),branch_id:selectedBranchId,slot:selectedSlotId,amount:total};bookingHttpRequest(URL.GET_CORPORATE_OFFERS,REQUEST_METHODS.POST,corporateData,corporateOffersConstant);}else{$('#corporate-offer').show();$('.reservation--curtain').addClass('open-corporate-form');}}else loginLink();});$(document).on('click','.share-reservation',(e)=>{e.preventDefault();e.stopPropagation();if(bookingData)$('#profile-share-booking-id').val(bookingData.booking_id);else $('#profile-share-booking-id').val(getBookingId(e));$('#share-reservation-mail').removeClass('hide');});$('#profile-reservation-email-share-input').on('input',(e)=>{if(validateEmail(e.target.value))enableShareEmailButton();else disableShareEmailButton();});function disableShareEmailButton(){$('#profile-reservation-email-share-button').addClass('anchor-disabled');}function enableShareEmailButton(){$('#profile-reservation-email-share-button').removeClass('anchor-disabled');}function getBookingId(e){return $(e.currentTarget).closest('article').attr('id');}$('#profile-reservation-email-share-button').click((e)=>{let booking;if(bookingData)booking=bookingData;else booking=profileBookingData.get($('#profile-share-booking-id').val());$('#share-reservation-mail').addClass('hide');window.location.href='mailto:'+$('#profile-reservation-email-share-input').val()+'?'+getEmailShareSubject(booking)+'&'+getEmailShareBody(booking);});function getEmailShareSubject(booking){return `subject=Booking #${booking.booking_id}`;}function getEmailShareBody(booking){return `body=Hi, ${getMailLineBreak()}${getMailLineBreak()} I have placed a booking on ${formatDate(booking.reservation_date)} at ${booking.branch_name}.${getEmailBranchAddress(booking)}`;}function getEmailBranchAddress(booking){return `${getMailLineBreak()}${getMailLineBreak()}Address: ${booking.branch_address} ${getMailLineBreak()} Directions: ${URL.GOOGLE_MAPS}${booking.lat},${booking.long} ${getMailLineBreak()} Contact Number: ${booking.branch_contact_no}`;}function getMailLineBreak(){return '%0D%0A';}$('#profile-reservation-email-share-close').click((e)=>{e.preventDefault();$('#share-reservation-mail').addClass('hide');});$('.select2-selection').click(function(){$(this).toggleClass('show');});$('#basic-info__card-close').click(function(e){showBasicInfoCard(e);});$('.basic-info__edit').click((e)=>{showBasicInfoCard(e);});function showBasicInfoCard(e){e.preventDefault();if((appliedVouchers&&appliedVouchers.length>0)||appliedCoupon||applyLoyaltyPoints||appliedCorporateCoupon){e.stopPropagation();toastr.error('Please remove the applied coupon/voucher and loyalty points');}else{$('.basic-info__card').hide();$('.basic-info__form').show();e.stopPropagation();}}$('#basic-info__form-done').click(function(e){e.preventDefault();$('.basic-info__form').hide();$('.basic-info__card').show();e.stopPropagation();});$(document).on('click','.value-button',()=>{});$('#coupons-vouchers-close').click(function(e){e.preventDefault();e.stopPropagation();hideBillingPageCurtain();$("#apply-coupon-value").val('');$('#coupons-vouchers').hide();$('#reservation-info').show();isCorporatePageActive=false;});$('#corporate-offer-close').click(function(e){e.preventDefault();hideBillingPageCurtain();$('#corporate-offer').hide();$('.reservation--curtain').removeClass('open-corporate-form');isCorporatePageActive=false;});$('#advance-pay-close').click(function(){$('#advance-pay').hide();});$('.reservation__success__reschedule').click(function(){$('#reservation-info').show();$('.reschedule-block').show();$('.no__slot__available').hide();$('#reservation__success').hide();});$('.reservation__success__cancel').click(function(){$('#reservation__success').hide();$('#reservation__cancellation').show();});$('.basic-info__menu').click(function(e){e.preventDefault();$('.basic-info__menu-block').toggle();});$('#basic-info__menu-close').click(function(e){e.preventDefault();e.stopPropagation();$('.basic-info__menu-block').hide();});$('#curtain-close').click(function(e){window.location.reload();});$('#buffet-link').click(function(e){e.preventDefault();$('#a-la-carte').hide();$('#buffet').show();$('#beverages').hide();});$('#a-la-carte-link').click(function(e){e.preventDefault();$('#a-la-carte').show();$('#buffet').hide();$('#beverages').hide();});$('#beverages-link').click(function(e){e.preventDefault();$('#a-la-carte').hide();$('#buffet').hide();$('#beverages').show();});$(document).on('click','.reservation__item__menu a',(e)=>{e.preventDefault();$('.reservation__item').removeClass('expanded');$(e.target).parent().parent().parent().addClass('expanded');});$(document).on('click','.reservation__item-menu__close .close',(e)=>{e.preventDefault();$(e.target).parent().parent().parent().removeClass('expanded');});$(window).scroll(function(){if($(window).width()>1023){let scroll=$(window).scrollTop();const vouchersBlock=$('.vouchers-carousel-content-block');const branchOverviewBlock=$('.store-content');let vouchers;let position=92;if(vouchersBlock.length>0)vouchers=vouchersBlock;else vouchers=branchOverviewBlock;if(vouchers.offset()&&vouchers.offset().top){let vouchersPosition=vouchers.offset().top-position;const reservationButton=$('#reserve-button');let button=$('.input--group-button');if(scroll>vouchersPosition){$(button).addClass('sticky');reservationButton.addClass('reservation-button-scroll-top');reservationButton.prop('disabled',false);}else{$(button).removeClass('sticky');reservationButton.removeClass('reservation-button-scroll-top');disableOrEnableReserveButton();}}}});function showElement(element,property='block'){$(element).css('display',property);}function hideElement(element){$(element).hide();}function setBillingData(data){bookingId=data.bookingId;currency=data.currency;buffetCurrency=getCurrencyCode(currency);selectedReservationDate=data.reservationDate;selectedBranchId=data.branchId;selectedSlotId=data.slotId;booking_info.reservationDate=getFormattedReservationDate(selectedReservationDate);$('#billing-booking-id').text(data.bookingId);$('#billing-customer-name').text(data.billJson.guestName);$('#billing-receipt-number').text(data.billJson.receiptNumber);$('#billing-date').text(data.billJson.date);$('#billing-table-number').text(data.billJson.tableNumber);$('#billing-invoice-url').attr('href',data.billLink);PROPS.TOTAL_QUANTITY=data.billJson.numberOfPax;$('#billing-order-details').append(data.billJson.orderDetails.map((orderDetails)=>{PROPS.TOTAL_AMOUNT+=orderDetails.net;return getOrderDetailsHtml(orderDetails);}));orderList=data.billJson.orderDetails;setAmountBlock(data.billJson);setPaymentDetailsHtml(data.billJson);setDiscountDetailsHtml(data.billJson);if(parseInt(data.loyaltyPoints,10)){applyLoyaltyPoints=true;loyaltyPointsApplied=parseInt(data.loyaltyPoints,10);loyaltyDiscountApplied=parseFloat(data.loyaltyPointsAmount);loyaltyExchangeRate=loyaltyDiscountApplied/loyaltyPointsApplied;$('#booking-loyalty-points').hide();PROPS.HIDE_LOYALTY_BLOCK=true;}showElement('.reservation__apply-vouchers');if(couponDiscountApplied){$('#billing-coupons-block').hide();appliedCoupon=undefined;}else $('.reservation__corporate-offers').show();getUserLoyaltyPoints();}function setPaymentDetailsHtml(billJson){if(billJson.paymentDetails&&billJson.paymentDetails.length>0){showElement('#billing-payment-details-block');$('#billing-payment-details').html(billJson.paymentDetails.map((paymentDetails)=>{if(paymentDetails.voucherNumber&&paymentDetails.amount){if(paymentDetails.paxApplicable>0)if(noOfVoucherDiscountAppliedWithPax){noOfVoucherDiscountAppliedWithPax+=paymentDetails.paxApplicable;voucherDiscountAppliedWithPax+=paymentDetails.amount;}else{noOfVoucherDiscountAppliedWithPax=paymentDetails.paxApplicable;voucherDiscountAppliedWithPax=paymentDetails.amount;}else if(voucherDiscountApplied)voucherDiscountApplied+=paymentDetails.amount;else voucherDiscountApplied=paymentDetails.amount;const voucherData={currency,bar_code:paymentDetails.voucherNumber,denomination:paymentDetails.amount,voucher_type:PROPS.VOUCHER_CODE,title:paymentDetails.name,pax_applicable:paymentDetails.paxApplicable?paymentDetails.paxApplicable:0};appliedVouchers.push(new Voucher(voucherData));}else{if(paymentDetails.amount&&paymentDetails.type!=='LOYALTY')PROPS.ADVANCE_AMOUNT_PAID+=paymentDetails.amount;}return paymentDiscountHtml(paymentDetails.name,paymentDetails.amount);}));}}function setDiscountDetailsHtml(billJson){if(billJson.discountDetails&&billJson.discountDetails.length>0){showElement('#billing-discount-details-block');$('#billing-discount-details').html(billJson.discountDetails.map((discountDetails)=>{if(discountDetails.type===PROPS.COUPON_TYPE&&discountDetails.couponNumber){appliedCoupon=true;if(discountDetails.name!=='MEAL_COUPON')if(couponDiscountApplied)couponDiscountApplied+=discountDetails.amount;else couponDiscountApplied=discountDetails.amount;const couponData={currency,bar_code:discountDetails.couponNumber,denomination:discountDetails.amount,voucher_type:PROPS.COUPON_CODE,title:discountDetails.name};appliedCoupon=new Voucher(couponData);}else{if(discountDetails.name!=='LOYALTY'&&discountDetails.name!=='COUPON'&&discountDetails.name!=='MEAL_COUPON'&&discountDetails.amount){PROPS.ADDITIONAL_DISCOUNTS+=discountDetails.amount;PROPS.INITIAL_ADDITIONAL_DISCOUNTS+=discountDetails.amount;}}return paymentDiscountHtml(discountDetails.name,discountDetails.amount);}));}}function paymentDiscountHtml(name,amount){return `<div>
              <h5>${name}</h5>
              <span>${amount}</span>
            </div>`;}function setAmountBlock(billJson){PROPS.GST_BASE_AMOUNT=billJson.gstBaseAmount;PROPS.CGST_PER=billJson.cgstPercentage;PROPS.SGST_PER=billJson.sgstPercentage;PROPS.SERVICE_CHARGE=billJson.serviceCharge;PROPS.VAT_AMOUNT=billJson.vatAmount;PROPS.VAT_PER=billJson.vatPercentage;PROPS.SUB_TOTAL=billJson.subTotal;PROPS.TOTAL_AMOUNT=billJson.totalAmount;PROPS.NET_PAYABLE=billJson.netPayable;PROPS.INITIAL_GST_BASE_AMOUNT=billJson.gstBaseAmount;PROPS.INITIAL_VAT_AMOUNT=billJson.vatBaseAmount;PROPS.START_VAT_AMOUNT=billJson.vatAmount;PROPS.INITIAL_SERVICE_CHARGE=billJson.serviceCharge;PROPS.INITIAL_SUB_TOTAL=billJson.subTotal;if(billJson.cessInPlaceOfVat||billJson.cessAmount){PROPS.CESS=billJson.cessInPlaceOfVat?billJson.cessInPlaceOfVat:billJson.cessAmount;PROPS.INITIAL_CESS=billJson.cessInPlaceOfVat?billJson.cessInPlaceOfVat:billJson.cessAmount;}PROPS.ADDITIONAL_TAXES=PROPS.VAT_AMOUNT+PROPS.CESS;reCalculateTaxAmount();if(!billJson.netPayable||billJson.billStatus!=='PR')$('#booking-confirmed-pay-advance-amount').addClass('anchor-disabled');$('#billing-net-payable').html(buffetCurrency+billJson.netPayable);$('#billing-sub-total').text(billJson.subTotal);if(PROPS.CGST_AMOUNT){showElement('#billing-tax-details-cgst-block','flex');$('#billing-tax-details-cgst').text(PROPS.CGST_AMOUNT);}if(PROPS.SGST_AMOUNT){showElement('#billing-tax-details-sgst-block','flex');$('#billing-tax-details-sgst').text(PROPS.SGST_AMOUNT);}if(PROPS.SERVICE_CHARGE){showElement('#billing-tax-details-service-charge-block','flex');$('#billing-tax-details-service-charge').text(PROPS.SERVICE_CHARGE);}if(PROPS.CESS){showElement('#billing-tax-details-cess-block','flex');$('#billing-tax-details-cess').text(PROPS.CESS);}if(PROPS.VAT_AMOUNT){showElement('#billing-tax-details-vat-block','flex');$('#billing-tax-details-vat').text(PROPS.VAT_AMOUNT);}$('#billing-total-amount').text(billJson.totalAmount);$('#billing-final-net-payable-amount').html(buffetCurrency+billJson.netPayable);$('#advance-amount').val(billJson.netPayable);}function getOrderDetailsHtml(orderDetails){return `<tr>
              <td>${orderDetails.description}</td>
              <td>${orderDetails.qty}</td>
              <td>${orderDetails.rate}</td>
              <td>${orderDetails.net}</td>
            </tr>`;}function getBookingDetails(bookingId){bookingHttpRequest(URL.GET_BILLING_DETAILS+bookingId,REQUEST_METHODS.GET,undefined,TYPE.GET_BILLING_DETAILS);}})(jQuery,Drupal,once);function formatDate(dateString){return moment(dateString).format('dddd, DD MMM, h:mm a');}function validateEmail(email){const emailPattern=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return emailPattern.test(email);}function getFormattedReservationDate(date){return moment(date).format('YYYY-MM-DD');}function getDatePickerFormattedDate(date){return date.format('DD/MM/YYYY');};(function(factory){if(typeof define==="function"&&define.amd)define(["jquery","./version"],factory);else factory(jQuery);}(function($){var widgetUuid=0,widgetSlice=Array.prototype.slice;$.cleanData=(function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++)try{events=$._data(elem,"events");if(events&&events.remove)$(elem).triggerHandler("remove");}catch(e){};orig(elems);};})($.cleanData);$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];var fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;};if($.isArray(prototype))prototype=$.extend.apply(null,[{}].concat(prototype));$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget)return new constructor(options,element);if(arguments.length)this._createWidget(options,element);};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;};proxiedPrototype[prop]=(function(){function _super(){return base.prototype[prop].apply(this,arguments);}function _superApply(args){return base.prototype[prop].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor,namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else base._childConstructors.push(constructor);$.widget.bridge(name,constructor);return constructor;};$.widget.extend=function(target){var input=widgetSlice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++)for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined)if($.isPlainObject(value))target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);else target[key]=value;};return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=widgetSlice.call(arguments,1),returnValue=this;if(isMethodCall)if(!this.length&&options==="instance")returnValue=undefined;else this.each(function(){var methodValue,instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false;};if(!instance)return $.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'");if(!$.isFunction(instance[options])||options.charAt(0)==="_")return $.error("no such method '"+options+"' for "+name+" widget instance");methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});else{if(args.length)options=$.widget.extend.apply(null,[options].concat(args));this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init)instance._init();}else $.data(this,fullName,new object(options,this));});};return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widgetUuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();this.classesElementLookup={};if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element)this.destroy();}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);};this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();if(this.options.disabled)this._setOptionDisabled(this.options.disabled);this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:function(){return{};},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy();$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key);});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace);},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0)return $.widget.extend({},this.options);if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];};key=parts.pop();if(arguments.length===1)return curOption[key]===undefined?null:curOption[key];curOption[key]=value;}else{if(arguments.length===1)return this.options[key]===undefined?null:this.options[key];options[key]=value;}};this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this;},_setOption:function(key,value){if(key==="classes")this._setOptionClasses(value);this.options[key]=value;if(key==="disabled")this._setOptionDisabled(value);return this;},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value){currentElements=this.classesElementLookup[classKey];if(value[classKey]===this.options.classes[classKey]||!currentElements||!currentElements.length)continue;elements=$(currentElements.get());this._removeClass(currentElements,classKey);elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:true}));}},_setOptionDisabled:function(value){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value);if(value){this._removeClass(this.hoverable,null,"ui-state-hover");this._removeClass(this.focusable,null,"ui-state-focus");}},enable:function(){return this._setOptions({disabled:false});},disable:function(){return this._setOptions({disabled:true});},_classes:function(options){var full=[],that=this;options=$.extend({element:this.element,classes:this.options.classes||{}},options);function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++){current=that.classesElementLookup[classes[i]]||$();if(options.add)current=$($.unique(current.get().concat(options.element.get())));else current=$(current.not(options.element).get());that.classesElementLookup[classes[i]]=current;full.push(classes[i]);if(checkOption&&options.classes[classes[i]])full.push(options.classes[classes[i]]);}};this._on(options.element,{remove:"_untrackClassesElement"});if(options.keys)processClassString(options.keys.match(/\S+/g)||[],true);if(options.extra)processClassString(options.extra.match(/\S+/g)||[]);return full.join(" ");},_untrackClassesElement:function(event){var that=this;$.each(that.classesElementLookup,function(key,value){if($.inArray(event.target,value)!==-1)that.classesElementLookup[key]=$(value.not(event.target).get());});},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,false);},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,true);},_toggleClass:function(element,keys,extra,add){add=(typeof add==="boolean")?add:extra;var shift=(typeof element==="string"||element===null),options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add};options.element.toggleClass(this._classes(options),add);return this;},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;};if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);};$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled")))return;return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);};if(typeof handler!=="string")handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector)delegateElement.on(eventName,selector,handlerProxy);else element.on(eventName,handlerProxy);});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.off(eventName).off(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get());},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);};var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,"ui-state-hover");},mouseleave:function(event){this._removeClass($(event.currentTarget),null,"ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,"ui-state-focus");},focusout:function(event){this._removeClass($(event.currentTarget),null,"ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig)for(prop in orig)if(!(prop in event))event[prop]=orig[prop];this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string")options={effect:options};var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number")options={duration:options};hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay)element.delay(options.delay);if(hasOptions&&$.effects&&$.effects.effect[effectName])element[method](options);else if(effectName!==method&&element[effectName])element[effectName](options.duration,options.easing,callback);else element.queue(function(next){$(this)[method]();if(callback)callback.call(element[0]);next();});};});return $.widget;}));;